<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/logo.png"><link rel="icon" href="/images/logo.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jas0n0ss"><meta name="keywords" content="oss"><meta name="description" content="setup k8s ha cluster with kubeasz"><meta property="og:type" content="article"><meta property="og:title" content="setup k8s ha cluster with kubeasz"><meta property="og:url" content="https://git.msft.vip/2023/10/18-setup-k8s-ha-cluster-with-kubeasz/index.html"><meta property="og:site_name" content="git.msft.vip"><meta property="og:description" content="setup k8s ha cluster with kubeasz"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://git.msft.vip/images/v2-d28aa5c21134bcc4d05bbfdcfc785e29_1440w.png"><meta property="article:published_time" content="2023-10-18T17:18:37.000Z"><meta property="article:modified_time" content="2024-08-09T12:13:50.173Z"><meta property="article:author" content="Jas0n0ss"><meta property="article:tag" content="k8s"><meta property="article:tag" content="kubeasz"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://git.msft.vip/images/v2-d28aa5c21134bcc4d05bbfdcfc785e29_1440w.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>setup k8s ha cluster with kubeasz - git.msft.vip</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom_icon/other/iconfont.css"><link rel="stylesheet" href="/css/custom_icon/phone/iconfont.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"git.msft.vip",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Jas0n0ss</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-shouye"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives"><i class="iconfont icon-guidang"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/tags"><i class="iconfont icon-biaoqian"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/video"><i class="iconfont icon-youtube"></i> <span>视频</span></a></li><li class="nav-item"><a class="nav-link" href="/music"><i class="iconfont icon-tubiaozhizuomobanyihuifu-"></i> <span>音乐</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/code.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="setup k8s ha cluster with kubeasz"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Jas0n0ss </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-10-19 01:18" pubdate>2023年10月19日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 8.2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 69 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">setup k8s ha cluster with kubeasz</h1><p class="note note-info">本文最后更新于：2024年8月9日 晚上</p><div class="markdown-body"><h3 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p><img src="/../images/v2-d28aa5c21134bcc4d05bbfdcfc785e29_1440w.png" srcset="/img/loading.gif" lazyload alt="高可用"></p><h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h3><table><thead><tr><th align="center">Cluster Role</th><th align="center">IP Address</th><th align="center">Component</th><th align="center">Hostname</th></tr></thead><tbody><tr><td align="center">Master-01</td><td align="center">192.168.3.11</td><td align="center"><code>kube-apiserver</code> <code>kube-controller-manager</code> <code>kube-scheduler</code> <code>ansible</code></td><td align="center">K8snode1</td></tr><tr><td align="center">Master-02</td><td align="center">192.168.3.12</td><td align="center"><code>kube-apiserver</code> <code>kube-controller-manager</code> <code>kube-scheduler</code></td><td align="center">K8snode2</td></tr><tr><td align="center">Worker-01</td><td align="center">192.168.3.13</td><td align="center"><code>Kubelet</code> <code>kube-proxy</code> <code>etcd</code></td><td align="center">K8snode3</td></tr><tr><td align="center">Worker-02</td><td align="center">192.168.3.14</td><td align="center"><code>Kubelet</code> <code>kube-proxy</code> <code>etcd</code> <code>keepalived</code> <code>haproxy</code></td><td align="center">K8snode4</td></tr><tr><td align="center">Worker-03</td><td align="center">192.168.3.15</td><td align="center"><code>Kubelet</code> <code>kube-proxy</code> <code>etcd</code> <code>keepalived</code> <code>haproxy</code></td><td align="center">K8snode5</td></tr></tbody></table><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><h4 id="env-prepare-on-deploy-server-k8snode1"><a href="#env-prepare-on-deploy-server-k8snode1" class="headerlink" title="env prepare on deploy server (k8snode1)"></a>env prepare on deploy server (k8snode1)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># env prepare on deploy server (k8snode1)</span><br>[root@node1 ~]<span class="hljs-comment"># ssh-keygen</span><br>[root@node1 ~]<span class="hljs-comment"># for i in 192.168.3.&#123;11..15&#125;;do ssh-copy-id root@$i;done</span><br>[root@node1 ~]<span class="hljs-comment"># yum install ansible -y</span><br>[root@node1 ~]<span class="hljs-comment"># egrep -v &#x27;^#|^$|#&#x27; /etc/ansible/hosts</span><br>192.168.3.[11:15]<br>[root@node1 ~]<span class="hljs-comment"># ansible all -m yum -a &#x27;name=vim,net-tools,epel-release,yum-utils.noarch,bash-completion state=present&#x27;</span><br>[root@node1 ~]<span class="hljs-comment"># ansible all -m shell -a &#x27;yum-config-manager --add-repo http://repo.srv/centos7/x86/&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="Kubeasz-setup-k8s"><a href="#Kubeasz-setup-k8s" class="headerlink" title="Kubeasz setup k8s"></a>Kubeasz setup k8s</h4><p><a target="_blank" rel="noopener" href="https://github.com/easzlab/kubeasz">https://github.com/easzlab/kubeasz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># download setup tool</span><br>[root@node1 ~]<span class="hljs-comment"># wget https://github.com/easzlab/kubeasz/releases/download/3.6.2/ezdown</span><br>[root@node1 ~]<span class="hljs-comment"># chmod +x ezdown</span><br>[root@node1 ~]<span class="hljs-comment"># ./ezdown -D # init kubeasz env, all files will be saved in /etc/kubeasz/</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl -h</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl new k8s01</span><br>[root@node1 ~]<span class="hljs-comment"># vim /etc/kubeasz/cluster/k8s01/hosts</span><br>[root@node1 ~]<span class="hljs-comment"># vim /etc/kubeasz/cluster/k8s01/config.yml</span><br>[root@node1 ~]<span class="hljs-comment"># egrep -v &quot;^$|^#|#&quot; /etc/kubeasz/clusters/k8slab/hosts</span><br>[etcd]<br>192.168.3.[13:15]<br>[kube_master]<br>192.168.3.11 k8s_nodename=<span class="hljs-string">&#x27;master-01&#x27;</span><br>192.168.3.12 k8s_nodename=<span class="hljs-string">&#x27;master-02&#x27;</span><br>[kube_node]<br>192.168.3.13 k8s_nodename=<span class="hljs-string">&#x27;worker-01&#x27;</span><br>192.168.3.14 k8s_nodename=<span class="hljs-string">&#x27;worker-02&#x27;</span><br>192.168.3.15 k8s_nodename=<span class="hljs-string">&#x27;worker-03&#x27;</span><br>[harbor]<br>[ex_lb]<br>192.168.3.15 LB_ROLE=backup EX_APISERVER_VIP=192.168.3.250 EX_APISERVER_PORT=8443<br>192.168.3.14 LB_ROLE=master EX_APISERVER_VIP=192.168.3.250 EX_APISERVER_PORT=8443<br>[chrony]<br>192.168.3.11<br>[all:vars]<br>SECURE_PORT=<span class="hljs-string">&quot;6443&quot;</span><br>CONTAINER_RUNTIME=<span class="hljs-string">&quot;containerd&quot;</span><br>CLUSTER_NETWORK=<span class="hljs-string">&quot;calico&quot;</span><br>PROXY_MODE=<span class="hljs-string">&quot;ipvs&quot;</span><br>SERVICE_CIDR=<span class="hljs-string">&quot;10.10.0.0/16&quot;</span><br>CLUSTER_CIDR=<span class="hljs-string">&quot;192.10.0.0/16&quot;</span><br>NODE_PORT_RANGE=<span class="hljs-string">&quot;30000-32767&quot;</span><br>CLUSTER_DNS_DOMAIN=<span class="hljs-string">&quot;cluster.k8slab&quot;</span><br>bin_dir=<span class="hljs-string">&quot;/opt/kube/bin&quot;</span><br>base_dir=<span class="hljs-string">&quot;/etc/kubeasz&quot;</span><br>cluster_dir=<span class="hljs-string">&quot;&#123;&#123; base_dir &#125;&#125;/clusters/k8slab&quot;</span><br>ca_dir=<span class="hljs-string">&quot;/etc/kubernetes/ssl&quot;</span><br>k8s_nodename=<span class="hljs-string">&#x27;&#x27;</span><br>ansible_python_interpreter=/usr/bin/python<br>[root@node1 ~]<span class="hljs-comment"># egrep -v &quot;^$|^#|#&quot; /etc/kubeasz/clusters/k8slab/config.yml</span><br>INSTALL_SOURCE: <span class="hljs-string">&quot;online&quot;</span><br>OS_HARDEN: <span class="hljs-literal">true</span><br>CA_EXPIRY: <span class="hljs-string">&quot;876000h&quot;</span><br>CERT_EXPIRY: <span class="hljs-string">&quot;438000h&quot;</span><br>CHANGE_CA: <span class="hljs-literal">false</span><br>CLUSTER_NAME: <span class="hljs-string">&quot;cluster1&quot;</span><br>CONTEXT_NAME: <span class="hljs-string">&quot;context-&#123;&#123; CLUSTER_NAME &#125;&#125;&quot;</span><br>K8S_VER: <span class="hljs-string">&quot;1.28.1&quot;</span><br>K8S_NODENAME: <span class="hljs-string">&quot;&#123;%- if k8s_nodename != &#x27;&#x27; -%&#125; \</span><br><span class="hljs-string">                    &#123;&#123; k8s_nodename|replace(&#x27;_&#x27;, &#x27;-&#x27;)|lower &#125;&#125; \</span><br><span class="hljs-string">               &#123;%- else -%&#125; \</span><br><span class="hljs-string">                    &#123;&#123; inventory_hostname &#125;&#125; \</span><br><span class="hljs-string">               &#123;%- endif -%&#125;&quot;</span><br>ETCD_DATA_DIR: <span class="hljs-string">&quot;/var/lib/etcd&quot;</span><br>ETCD_WAL_DIR: <span class="hljs-string">&quot;&quot;</span><br>ENABLE_MIRROR_REGISTRY: <span class="hljs-literal">true</span><br>INSECURE_REG:<br>  - <span class="hljs-string">&quot;http://easzlab.io.local:5000&quot;</span><br>  - <span class="hljs-string">&quot;https://&#123;&#123; HARBOR_REGISTRY &#125;&#125;&quot;</span><br>SANDBOX_IMAGE: <span class="hljs-string">&quot;easzlab.io.local:5000/easzlab/pause:3.9&quot;</span><br>CONTAINERD_STORAGE_DIR: <span class="hljs-string">&quot;/var/lib/containerd&quot;</span><br>DOCKER_STORAGE_DIR: <span class="hljs-string">&quot;/var/lib/docker&quot;</span><br>DOCKER_ENABLE_REMOTE_API: <span class="hljs-literal">false</span><br>MASTER_CERT_HOSTS:<br>  - <span class="hljs-string">&quot;192.168.3.11&quot;</span><br>  - <span class="hljs-string">&quot;192.168.3.12&quot;</span><br>  - <span class="hljs-string">&quot;192.168.3.250&quot;</span><br>  - <span class="hljs-string">&quot;k8s.easzlab.io&quot;</span><br>NODE_CIDR_LEN: 24<br>KUBELET_ROOT_DIR: <span class="hljs-string">&quot;/var/lib/kubelet&quot;</span><br>MAX_PODS: 110<br>KUBE_RESERVED_ENABLED: <span class="hljs-string">&quot;no&quot;</span><br>SYS_RESERVED_ENABLED: <span class="hljs-string">&quot;no&quot;</span><br>FLANNEL_BACKEND: <span class="hljs-string">&quot;vxlan&quot;</span><br>DIRECT_ROUTING: <span class="hljs-literal">false</span><br>flannel_ver: <span class="hljs-string">&quot;v0.22.2&quot;</span><br>CALICO_IPV4POOL_IPIP: <span class="hljs-string">&quot;Always&quot;</span><br>IP_AUTODETECTION_METHOD: <span class="hljs-string">&quot;can-reach=&#123;&#123; groups[&#x27;kube_master&#x27;][0] &#125;&#125;&quot;</span><br>CALICO_NETWORKING_BACKEND: <span class="hljs-string">&quot;bird&quot;</span><br>CALICO_RR_ENABLED: <span class="hljs-literal">false</span><br>CALICO_RR_NODES: []<br>calico_ver: <span class="hljs-string">&quot;v3.24.6&quot;</span><br>calico_ver_main: <span class="hljs-string">&quot;&#123;&#123; calico_ver.split(&#x27;.&#x27;)[0] &#125;&#125;.&#123;&#123; calico_ver.split(&#x27;.&#x27;)[1] &#125;&#125;&quot;</span><br>cilium_ver: <span class="hljs-string">&quot;1.13.6&quot;</span><br>cilium_connectivity_check: <span class="hljs-literal">true</span><br>cilium_hubble_enabled: <span class="hljs-literal">false</span><br>cilium_hubble_ui_enabled: <span class="hljs-literal">false</span><br>kube_ovn_ver: <span class="hljs-string">&quot;v1.11.5&quot;</span><br>OVERLAY_TYPE: <span class="hljs-string">&quot;full&quot;</span><br>FIREWALL_ENABLE: <span class="hljs-literal">true</span><br>kube_router_ver: <span class="hljs-string">&quot;v1.5.4&quot;</span><br>dns_install: <span class="hljs-string">&quot;yes&quot;</span><br>corednsVer: <span class="hljs-string">&quot;1.11.1&quot;</span><br>ENABLE_LOCAL_DNS_CACHE: <span class="hljs-literal">true</span><br>dnsNodeCacheVer: <span class="hljs-string">&quot;1.22.23&quot;</span><br>LOCAL_DNS_CACHE: <span class="hljs-string">&quot;169.254.20.10&quot;</span><br>metricsserver_install: <span class="hljs-string">&quot;yes&quot;</span><br>metricsVer: <span class="hljs-string">&quot;v0.6.4&quot;</span><br>dashboard_install: <span class="hljs-string">&quot;yes&quot;</span><br>dashboardVer: <span class="hljs-string">&quot;v2.7.0&quot;</span><br>dashboardMetricsScraperVer: <span class="hljs-string">&quot;v1.0.8&quot;</span><br>prom_install: <span class="hljs-string">&quot;yes&quot;</span><br>prom_namespace: <span class="hljs-string">&quot;monitor&quot;</span><br>prom_chart_ver: <span class="hljs-string">&quot;45.23.0&quot;</span><br>kubeapps_install: <span class="hljs-string">&quot;no&quot;</span><br>kubeapps_install_namespace: <span class="hljs-string">&quot;kubeapps&quot;</span><br>kubeapps_working_namespace: <span class="hljs-string">&quot;default&quot;</span><br>kubeapps_storage_class: <span class="hljs-string">&quot;local-path&quot;</span><br>kubeapps_chart_ver: <span class="hljs-string">&quot;12.4.3&quot;</span><br>local_path_provisioner_install: <span class="hljs-string">&quot;no&quot;</span><br>local_path_provisioner_ver: <span class="hljs-string">&quot;v0.0.24&quot;</span><br>local_path_provisioner_dir: <span class="hljs-string">&quot;/opt/local-path-provisioner&quot;</span><br>nfs_provisioner_install: <span class="hljs-string">&quot;no&quot;</span><br>nfs_provisioner_namespace: <span class="hljs-string">&quot;kube-system&quot;</span><br>nfs_provisioner_ver: <span class="hljs-string">&quot;v4.0.2&quot;</span><br>nfs_storage_class: <span class="hljs-string">&quot;managed-nfs-storage&quot;</span><br>nfs_server: <span class="hljs-string">&quot;192.168.1.10&quot;</span><br>nfs_path: <span class="hljs-string">&quot;/data/nfs&quot;</span><br>network_check_enabled: <span class="hljs-literal">true</span><br>network_check_schedule: <span class="hljs-string">&quot;*/5 * * * *&quot;</span><br>HARBOR_VER: <span class="hljs-string">&quot;v2.6.4&quot;</span><br>HARBOR_DOMAIN: <span class="hljs-string">&quot;harbor.easzlab.io.local&quot;</span><br>HARBOR_PATH: /var/data<br>HARBOR_TLS_PORT: 8443<br>HARBOR_REGISTRY: <span class="hljs-string">&quot;&#123;&#123; HARBOR_DOMAIN &#125;&#125;:&#123;&#123; HARBOR_TLS_PORT &#125;&#125;&quot;</span><br>HARBOR_SELF_SIGNED_CERT: <span class="hljs-literal">true</span><br>HARBOR_WITH_NOTARY: <span class="hljs-literal">false</span><br>HARBOR_WITH_TRIVY: <span class="hljs-literal">false</span><br>HARBOR_WITH_CHARTMUSEUM: <span class="hljs-literal">true</span><br><span class="hljs-comment">####</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup -h</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 all </span><br><span class="hljs-comment">###</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 01</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 02</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 03</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 04</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 05</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 06</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 07</span><br>[root@node1 ~]<span class="hljs-comment"># /etc/kubeasz/ezctl setup k8s01 ex-lb</span><br><span class="hljs-comment">##</span><br>[root@node1 ~]<span class="hljs-comment"># kubectl get node -o wide</span><br>NAME        STATUS                     ROLES    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                CONTAINER-RUNTIME<br>master-01   Ready,SchedulingDisabled   master   19m   v1.28.1   192.168.3.11   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.71.1.el7.x86_64   containerd://1.6.23<br>master-02   Ready,SchedulingDisabled   master   19m   v1.28.1   192.168.3.12   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.71.1.el7.x86_64   containerd://1.6.23<br>worker-01   Ready                      node     17m   v1.28.1   192.168.3.13   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.71.1.el7.x86_64   containerd://1.6.23<br>worker-02   Ready                      node     17m   v1.28.1   192.168.3.14   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.71.1.el7.x86_64   containerd://1.6.23<br>worker-03   Ready                      node     17m   v1.28.1   192.168.3.15   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.71.1.el7.x86_64   containerd://1.6.23<br>[root@node1 ~]<span class="hljs-comment"># kubectl get pod -n kube-system</span><br>NAME                                         READY   STATUS    RESTARTS   AGE<br>calico-kube-controllers-86b55cf789-6l69w     1/1     Running   0          17m<br>calico-node-2tlph                            1/1     Running   0          17m<br>calico-node-br4qf                            1/1     Running   0          17m<br>calico-node-bxnpg                            1/1     Running   0          17m<br>calico-node-r74ns                            1/1     Running   0          17m<br>calico-node-tzcm9                            1/1     Running   0          17m<br>coredns-7bc88ddb8b-dtk4t                     1/1     Running   0          16m<br>dashboard-metrics-scraper-77b667b99d-gs6mt   1/1     Running   0          16m<br>kubernetes-dashboard-74fb9f77fb-cd6pc        1/1     Running   0          16m<br>metrics-server-dfb478476-q62nr               1/1     Running   0          16m<br>node-local-dns-chmpp                         1/1     Running   0          16m<br>node-local-dns-cphrq                         1/1     Running   0          16m<br>node-local-dns-wmp4f                         1/1     Running   0          16m<br>node-local-dns-z8hx7                         1/1     Running   0          16m<br>node-local-dns-zbnv8                         1/1     Running   0          16m<br></code></pre></td></tr></table></figure><h4 id="Live-demo"><a href="#Live-demo" class="headerlink" title="Live demo"></a>Live demo</h4><script type="text/javascript" src="https://asciinema.org/a/Uunw1gW6PSDLXmSMPqG3y8ouF.js" id="asciicast-Uunw1gW6PSDLXmSMPqG3y8ouF" async></script><h4 id="K8s-dashboard"><a href="#K8s-dashboard" class="headerlink" title="K8s dashboard"></a>K8s dashboard</h4><ul><li>kuboard: <a target="_blank" rel="noopener" href="https://kuboard.cn/install/v3/install-in-k8s.html#%E5%AE%89%E8%A3%85">https://kuboard.cn/install/v3/install-in-k8s.html#%E5%AE%89%E8%A3%85</a></li><li>Kubesphere: <a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.4/quick-start/all-in-one-on-linux/">https://kubesphere.io/zh/docs/v3.4/quick-start/all-in-one-on-linux/</a></li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/devops/" class="category-chain-item">devops</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/k8s/">#k8s</a> <a href="/tags/kubeasz/">#kubeasz</a></div></div><div class="license-box my-3"><div class="license-title"><div>setup k8s ha cluster with kubeasz</div><div>https://git.msft.vip/2023/10/18-setup-k8s-ha-cluster-with-kubeasz/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Jas0n0ss</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年10月19日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年8月9日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="ND - 禁止演绎"><i class="iconfont icon-nd"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/10/20-update-linux-server-terminal-PS1-script/" title="update linux server terminal PS1 script"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">update linux server terminal PS1 script</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/09/29-Traveling-map-202310/" title="Traveling map 202310"><span class="hidden-mobile">Traveling map 202310</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>Fluid.utils.loadComments("#disqus_thread",(function(){Fluid.utils.createCssLink("https://cdn.staticfile.org/disqusjs/1.3.0/disqusjs.css"),Fluid.utils.createScript("https://cdn.staticfile.org/disqusjs/1.3.0/disqus.js",(function(){new DisqusJS({shortname:"fluid",apikey:""})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js",(function(){mermaid.initialize({theme:"default"}),Fluid.events.registerRefreshCallback((function(){"mermaid"in window&&mermaid.init()}))}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Copyrights</span></a> <i class="iconfont icon-love"></i> <a href="https://git.msft.vip" target="_blank" rel="nofollow noopener"><span>Jas0n0ss</span></a></div></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://cdn.staticfile.org/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://cdn.staticfile.org/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://cdn.staticfile.org/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>