<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/logo.png"><link rel="icon" href="/images/logo.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jas0n0ss"><meta name="keywords" content="oss"><meta name="description" content="Very detailed tutorial on Dockerfile. FROM基础image的来源。  FROM &lt;repository&gt;:[tag] 123FROM busybox # will pull latest tag by defaultFROM busybox:latest # 默认使用hub.docker.com 仓库imageFROM registry.cn-"><meta property="og:type" content="article"><meta property="og:title" content="Dockerfile Tutorial"><meta property="og:url" content="https://git.msft.vip/2023/01/14-Dockerfile-How-to/index.html"><meta property="og:site_name" content="git.msft.vip"><meta property="og:description" content="Very detailed tutorial on Dockerfile. FROM基础image的来源。  FROM &lt;repository&gt;:[tag] 123FROM busybox # will pull latest tag by defaultFROM busybox:latest # 默认使用hub.docker.com 仓库imageFROM registry.cn-"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-01-14T18:29:04.000Z"><meta property="article:modified_time" content="2024-08-09T12:13:50.165Z"><meta property="article:author" content="Jas0n0ss"><meta property="article:tag" content="Dockerfile"><meta name="twitter:card" content="summary_large_image"><meta name="referrer" content="no-referrer-when-downgrade"><title>Dockerfile Tutorial - git.msft.vip</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom_icon/other/iconfont.css"><link rel="stylesheet" href="/css/custom_icon/phone/iconfont.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"git.msft.vip",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Jas0n0ss</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-shouye"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives"><i class="iconfont icon-guidang"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/tags"><i class="iconfont icon-biaoqian"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/video"><i class="iconfont icon-youtube"></i> <span>视频</span></a></li><li class="nav-item"><a class="nav-link" href="/music"><i class="iconfont icon-tubiaozhizuomobanyihuifu-"></i> <span>音乐</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/code.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Dockerfile Tutorial"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Jas0n0ss </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-01-15 02:29" pubdate>2023年1月15日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.7k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 48 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Dockerfile Tutorial</h1><p class="note note-info">本文最后更新于：2024年8月9日 晚上</p><div class="markdown-body"><p>Very detailed tutorial on <code>Dockerfile</code>.</p><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a><code>FROM</code></h4><p>基础<code>image</code>的来源。</p><ul><li><p>FROM <code>&lt;repository&gt;</code>:<code>[tag]</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> busybox <span class="hljs-comment"># will pull latest tag by default</span><br><span class="hljs-keyword">FROM</span> busybox:latest <span class="hljs-comment"># 默认使用hub.docker.com 仓库image</span><br><span class="hljs-keyword">FROM</span> registry.cn-shenzhen.aliyuncs.com/abo/devops:v1<br></code></pre></td></tr></table></figure></li><li><p>FROM <code>&lt;repository&gt;</code>@<code>&lt;digest&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> alpine@sha256:d7342993700f8cd7aba8496c2d0e57be0666e80b4c441925fc6f9361fa81d10e<br><span class="hljs-comment"># docker pull 通过digest方式 </span><br>docker pull alpine@sha256:d7342993700f8cd7aba8496c2d0e57be0666e80b4c441925fc6f9361fa81d10e<br></code></pre></td></tr></table></figure></li></ul><h4 id="MAINTANTIER"><a href="#MAINTANTIER" class="headerlink" title="MAINTANTIER "></a><code>MAINTANTIER</code></h4><p>添加维护者等信息。</p><ul><li><code>MAINTANTIER</code> <code>&lt;infomatin&gt;</code></li></ul><p>注意： <code>MAINTANTIER</code>语法已经被新的<code>LABEL</code>替代</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 维护着信息或者作者信息，可有可无</span><br>MAINTANTIER <span class="hljs-string">&quot;Peter&lt;westlife@aliyun.com&gt;&quot;</span><br></code></pre></td></tr></table></figure><h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL "></a><code>LABEL</code></h4><p>作用和<code>MAINTANTIER</code>一摸一样</p><p>语法格式：LABEL <code>&lt;key&gt;=&lt;vale&gt;</code> <code>&lt;key&gt;=&lt;vale&gt;</code> …</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">LABEL</span> author=<span class="hljs-string">&quot;Peter&lt;westlife<span class="hljs-variable">@aliyun</span>.com&gt;&quot;</span><br></code></pre></td></tr></table></figure><h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY "></a><code>COPY</code></h4><p>复制文件或者目录.</p><ul><li><p><code>COPY &lt;src&gt; &lt;dest&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 所有的copy都指的是Dockerfile当前目录下的文件来讲的</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> test.tar.gz /data/web/</span><br></code></pre></td></tr></table></figure></li><li><p><code>COPY</code> <code>[&quot;&lt;src&gt;&quot;</code>, …<code>&quot;&lt;dest&gt;&quot;]</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">COPY</span><span class="language-bash"> [<span class="hljs-string">&quot;test.tar.gz&quot;</span>,<span class="hljs-string">&quot;/data/web/&quot;</span>]</span><br></code></pre></td></tr></table></figure></li><li><p>注意事项</p><ul><li><p><code>src</code> 支持通配符</p></li><li><p><code>dest</code> 建议使用绝对路径</p></li><li><p>路径中不能存在空白字符，常用第二种格式</p></li><li><p><code>src</code> 是目录，只会复制其下层目录以及文件，不会复制<code>src</code> 目录本身到<code>dest</code></p></li><li><p>指定了多个<code>src</code>或者使用了通配符，<code>dest</code>必须是同一个，且dest必须以<code>/</code>结尾</p></li></ul></li></ul><h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a><code>ADD</code></h4><p>复制添加文件或者目录.</p><ul><li><p><code>ADD</code> <code>&lt;src&gt; &lt;dest&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 复制压缩包以及index.html文件到/data/web/目录下,并且压缩包会被自动解压，仅仅本地src才会被解压</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.tar.gz index.html /data/web/</span><br><span class="hljs-comment"># 支持SRC为URL，请注意dest后面带/和不带区别</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> http://aliyun.com/test.tar.gz /data/web <span class="hljs-comment"># 添加文件并且被命名为web</span></span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> http://aliyun.com/test.tar.gz /data/web/ <span class="hljs-comment"># 添加文件到/data/web/</span></span><br></code></pre></td></tr></table></figure></li><li><p><code>ADD</code> <code>[&quot;&lt;src&gt;&quot;, ...&quot;&lt;dest&gt;&quot;]</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 添加URL的压缩文件和本地index文件到目标目录</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> [<span class="hljs-string">&quot;http://5.5.5.100:8000/software/linux/nginx-1.18.0.tar.gz&quot;</span>,<span class="hljs-string">&quot;index.html&quot;</span>,<span class="hljs-string">&quot;/data/web/&quot;</span>]</span><br><span class="hljs-comment"># 添加本地的两个文件到目标目录</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> [<span class="hljs-string">&quot;test.tar.gz&quot;</span>,<span class="hljs-string">&quot;index.html&quot;</span>,<span class="hljs-string">&quot;/data/web/&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a><code>VOLUME</code></h4><p>用于在<code>image</code>中创建一个挂载点，以挂载<code>docker host</code>上的卷或者其他容器上的卷</p><ul><li><p><code>VOLUME</code> <code>&lt;mointpoint&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">VOLUME</span><span class="language-bash"> /data/mydata/ </span><br></code></pre></td></tr></table></figure></li><li><p><code>VOLUME</code> <code>[&quot;&lt;mountpoint&gt;&quot;]</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/data/mydata/&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>注意：如果挂载点路径此前存在文件，&#96;&#96;docker run&#96;后会在挂载完成后将此前文件复制到新的挂载卷中</p></blockquote><h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE "></a><code>EXPOSE</code></h4><p>容器运行起来向外需要暴露的端口。</p><p><code>EXPOSE</code> <code>&lt;port&gt;</code>&#x2F;<code>&lt;[tcp|udp]&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 可以定义多个端口暴露</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span>/tcp <span class="hljs-number">2222</span>/udp<br></code></pre></td></tr></table></figure><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>容器定义环境变量，可以被<code>ENV</code> <code>ADD</code> <code>COPY</code> 所调用</p><ul><li><p><code>ENV</code> <code>&lt;key&gt;</code> <code>&lt;value&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">#  这种方式中，key后面的所有内容都会被认为是value的值，因此这种只能定义一个变量</span><br><span class="hljs-keyword">ENV</span> HTTP_ROOT /usr/local/nginx/html/<br></code></pre></td></tr></table></figure></li><li><p><code>ENV</code> <code>&lt;key&gt;=&lt;value&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 此种方式可以定义多个变量</span><br><span class="hljs-keyword">ENV</span> HTTP_ROOT=<span class="hljs-string">&quot;/usr/local/nginx/html/&quot;</span> \<br>		<span class="hljs-keyword">WORKDIR</span><span class="language-bash">=<span class="hljs-string">&quot;/data/web/&quot;</span></span><br>		PORT=<span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p>调用方式：<code>$HTTP_ROOT</code> or <code>$&#123;HTTP_ROOT&#125;</code></p></li></ul><h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a><code>RUN</code></h4><p>**<code>docker build</code>**过程中需要运行的命令.</p><ul><li><p><code>RUN</code> <code>&lt;command&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 这种方式是以 /bin/sh -c 来运行mkdir，容器PID不为1，不能接受unix信号</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /data/web</span><br></code></pre></td></tr></table></figure></li><li><p><code>RUN</code> [“<code>&lt;command&gt;</code>“,”<code>&lt;参数1&gt;</code>“,”<code>&lt;参数n&gt;</code>“]</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 这种方式不是以 /bin/sh -c 来运行mkdir</span><br><span class="hljs-keyword">ENV</span> HTTP_ROOT=<span class="hljs-string">&quot;/data/test/&quot;</span><br><span class="hljs-comment"># 以下三种方式均可创建指定目录</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;mkdir&quot;</span>,<span class="hljs-string">&quot;-p&quot;</span>,<span class="hljs-string">&quot;<span class="hljs-variable">$HTTP_ROOT</span>&quot;</span>]</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;mkdir&quot;</span>,<span class="hljs-string">&quot;-p <span class="hljs-variable">$HTTP_ROOT</span>&quot;</span>]</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;mkdir&quot;</span>,<span class="hljs-string">&quot;p <span class="hljs-variable">$&#123;HTTP_ROOT&#125;</span>&quot;</span>] </span><br><span class="hljs-comment"># 如果要依赖shell特性以这种方式运行运行，请参照下面的格式，标准写法，推荐用以下方式</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/bash&quot;</span>,-c<span class="hljs-string">&quot;,&quot;</span><span class="hljs-built_in">mkdir</span><span class="hljs-string">&quot;, &quot;</span>-p<span class="hljs-string">&quot;,&quot;</span><span class="hljs-variable">$HTTP_ROOT</span><span class="hljs-string">&quot;]</span></span><br></code></pre></td></tr></table></figure></li></ul><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p><strong><code>docker run</code><strong>过程中，容器运行起来需要执行的命令，注意和<code>RUN</code>做对比.</strong><code>RUN</code>是构建过程需要的命令，<code>CMD</code>是容器运行起来运行的命令</strong>.</p><ul><li><p><code>CMD</code> <code>&lt;完整的命令以及参数&gt;</code></p><p><strong><code>CMD</code>指定的命令可以被<code>docker run</code>后面的命令覆盖</strong>!!!</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> HTTP_ROOT=<span class="hljs-string">&quot;/data/test/&quot;</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> /bin/httpd -f -h <span class="hljs-variable">$HTTP_ROOT</span></span><br></code></pre></td></tr></table></figure></li><li><p><code>CMD</code> [“<code>&lt;command&gt;</code>“,”<code>&lt;参数1&gt;</code>“,”<code>&lt;参数n&gt;</code>“]</p><p>这种方式 <strong>方括号内无法读取环境变量参数</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> HTTP_ROOT=<span class="hljs-string">&quot;/data/test/&quot;</span><br><span class="hljs-comment"># 错误写法</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/httpd&quot;</span>,<span class="hljs-string">&quot;-f&quot;</span>,<span class="hljs-string">&quot;-h&quot;</span>,<span class="hljs-string">&quot;<span class="hljs-variable">$HTTP_ROOT</span>&quot;</span>]  <span class="hljs-comment"># 这种方式CMD无法获取变量参数，</span></span><br><span class="hljs-comment"># 正确写法</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/httpd&quot;</span>,<span class="hljs-string">&quot;-f&quot;</span>,<span class="hljs-string">&quot;-h /data/web/html/&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/httpd&quot;</span>,<span class="hljs-string">&quot;-f&quot;</span>,<span class="hljs-string">&quot;-h&quot;</span>,<span class="hljs-string">&quot;/data/web/html/&quot;</span>]</span><br></code></pre></td></tr></table></figure></li><li><p><code>CMD</code> [“<code>&lt;参数1</code>&gt;”,”<code>&lt;参数2&gt;</code>“,”<code>&lt;参数n&gt;</code>“]</p><p>此种方式用于为<code>ENTRYPOINT</code> 提供默认参数</p></li></ul><h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>功能和<code>CMD</code>一样,但是有差异，**<code>ENTRYPOINT</code> 运行的命令不可以被<code>docker run</code>后面的命令覆盖**</p><ul><li><p><code>ENTRYPOINT</code> <code>[&quot;&lt;command&gt;&quot;]</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 为ENTRYPOINT提供运行参数,作用等于 CMD [&quot;/bin/httpd&quot;,&quot;-f&quot;,&quot;-h&quot;,&quot;/data/web/html&quot;]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;-f&quot;</span>,<span class="hljs-string">&quot;-h&quot;</span>,<span class="hljs-string">&quot;/data/web/html&quot;</span>]</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/httpd&quot;</span>]</span><br></code></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">####</span><br>vim entrypoint.sh<br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-built_in">cat</span> &gt;/etc/nginx/conf.d/www.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">server &#123;</span><br><span class="hljs-string">  server_name $HOSTNAME;</span><br><span class="hljs-string">  listen $&#123;IP:-0.0.0.0&#125;:$&#123;PORT:-80&#125;;   # -80和-0.0.0.0均为预设变量语法格式，如果未有变量输入将启动默认参数</span><br><span class="hljs-string">  root $&#123;NGX_ROOT:-/usr/share/nginx/html&#125;;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span>    <span class="hljs-comment"># 此脚本运行完成后进程将被其所有参数替换</span><br><span class="hljs-comment">#####</span><br>vim Dockerfile<br>FROM nginx:1.18-alpine<br>LABEL author=<span class="hljs-string">&quot;Jason Hu&quot;</span><br>ENV NGX_ROOT=<span class="hljs-string">&quot;/data/nginx/html/&quot;</span><br>ADD entrypoint.sh /bin/ <br>ADD	index.html <span class="hljs-variable">$NGX_ROOT</span><br>RUN <span class="hljs-built_in">chmod</span> +x /bin/entrypoint.sh <br>ENTRYPOINT [<span class="hljs-string">&quot;/bin/entrypoint.sh&quot;</span>]<br>CMD  [<span class="hljs-string">&quot;/usr/sbin/nginx&quot;</span>,<span class="hljs-string">&quot;-g&quot;</span>,<span class="hljs-string">&quot;daemon off;&quot;</span>]<br><span class="hljs-comment">####</span><br>docker build -t nginx:lab .<br><span class="hljs-comment"># use build image but web page still is the default not the one we defined, I&#x27;m thinking where did I miss?</span><br>docker run --<span class="hljs-built_in">rm</span> -itd -p 80:80 nginx:lab &amp;&amp; curl localhost<br></code></pre></td></tr></table></figure></li></ul><h4 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a><code>HEALTHCHECK</code></h4><p>用于容器的健康检查.</p><ul><li><p><code>HEALTHCHECK</code> [options] <code>CMD</code> <code>&lt;command&gt;</code></p><ul><li><code>options</code> 可以有以下几种：<ol><li><code>--interval</code>&#x3D;<code>&lt;value&gt;</code> # default 30s</li><li><code>--timeout</code>&#x3D;<code>&lt;value&gt;</code> # default 30s</li><li><code>--start-period</code>&#x3D;<code>&lt;value&gt;</code> # default 0s</li><li><code>—retries</code>&#x3D;<code>&lt;value&gt;</code> # default 3</li></ol></li></ul><p>在容器内部运行命令检查健康状态,检查的结果状态值有以下三种：</p><ol><li><code>0</code>—<code>succeed</code> <code>healthy</code></li><li><code>1</code>— <code>unhealthy</code></li><li><code>2</code>— <code>reserved</code></li></ol></li><li><p><code>HEALTHCHECK</code> <code>NONE</code></p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">HEALTHCHECK</span><span class="language-bash"> --interval=5m --<span class="hljs-built_in">timeout</span>=3s --start-period=5s \</span><br><span class="language-bash">CMD wegt -O - -q http://<span class="hljs-variable">$&#123;IP:-0.0.0.0&#125;</span>:&#123;PORT:-80&#125;/</span><br><span class="hljs-comment"># CMD curl -f http://localhost/ || exit 1</span><br></code></pre></td></tr></table></figure><h3 id="SHELL"><a href="#SHELL" class="headerlink" title="SHELL"></a><code>SHELL</code></h3><p>指定默认<code>shell</code>来运行命令，<code>Linux</code> 不指定默认是 <code>[&quot;/bin/sh&quot;,&quot;-c&quot;]</code> , Windows 默认不指定是<code>[&quot;CMD&quot;,&quot;/S&quot;,&quot;/C&quot;]</code>,<code>SHELL</code>可以在<code>Dockerfil</code>中出现多次</p><p><code>SHELL</code> <code>[&quot;&lt;command&gt;&quot;,&quot;&lt;参数&gt;&quot;]</code></p><ul><li><p><code>STOPSIGNAL</code></p><p>容器接受的unix信号来退出容器.</p><p><code>STOPSIGNAL</code> <code>&lt;signal&gt;</code></p></li><li><p><code>ARG</code></p><p>在<code>docker build</code> 过程中定义的变量，可以使用<code>--build-arg &lt;key&gt;=&lt;value&gt;</code>来引入</p><p><code>ARG</code> <code>&lt;key&gt;=&lt;value&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ARG</span> author=scofield<br><span class="hljs-keyword">LABEL</span><span class="language-bash"> maintainer=<span class="hljs-variable">$&#123;author&#125;</span></span><br>docker build --build-<span class="hljs-keyword">arg</span> author=westlife -t test:v10 .<br><span class="hljs-comment"># 新创建的出来的镜像 maintainer=westlife</span><br></code></pre></td></tr></table></figure></li><li><p><code>ONBUILD</code></p><p>用于在<code>Dockerfile</code>中定义一个触发器,自己创建的<code>image</code> 被另外一个<code>Dockerfile</code>用作基础镜像时会执行的指令</p><p>语法格式：</p><p><code>ONBUILD</code> <code>&lt;Dockerfile指令&gt;</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ONBUILD</span> <span class="hljs-keyword">ADD</span><span class="language-bash"> http://nginx.org/download/nginx-1.19.4.tar.gz /data/nginx/</span><br></code></pre></td></tr></table></figure></li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Docker/" class="category-chain-item">Docker</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Dockerfile/">#Dockerfile</a></div></div><div class="license-box my-3"><div class="license-title"><div>Dockerfile Tutorial</div><div>https://git.msft.vip/2023/01/14-Dockerfile-How-to/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Jas0n0ss</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年1月15日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年8月9日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="ND - 禁止演绎"><i class="iconfont icon-nd"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/01/15-hackintosh/" title="Hackintosh-in-intel-platform"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Hackintosh-in-intel-platform</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/01/13-Manage-docker-remotely/" title="Manage docker remotely"><span class="hidden-mobile">Manage docker remotely</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>Fluid.utils.loadComments("#disqus_thread",(function(){Fluid.utils.createCssLink("https://cdn.staticfile.org/disqusjs/1.3.0/disqusjs.css"),Fluid.utils.createScript("https://cdn.staticfile.org/disqusjs/1.3.0/disqus.js",(function(){new DisqusJS({shortname:"fluid",apikey:""})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js",(function(){mermaid.initialize({theme:"default"}),Fluid.events.registerRefreshCallback((function(){"mermaid"in window&&mermaid.init()}))}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Copyrights</span></a> <i class="iconfont icon-love"></i> <a href="https://git.msft.vip" target="_blank" rel="nofollow noopener"><span>Jas0n0ss</span></a></div></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://cdn.staticfile.org/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://cdn.staticfile.org/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://cdn.staticfile.org/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>