<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/logo.png"><link rel="icon" href="/images/logo.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jas0n0ss"><meta name="keywords" content="oss"><meta name="description" content="Ansible Detailed Tutorial I"><meta property="og:type" content="article"><meta property="og:title" content="Ansible Detailed Tutorial I"><meta property="og:url" content="https://git.msft.vip/2023/01/31-Ansible-Detailed-Tutorial-I/index.html"><meta property="og:site_name" content="git.msft.vip"><meta property="og:description" content="Ansible Detailed Tutorial I"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://git.msft.vip/"><meta property="og:image" content="https://git.msft.vip/images/1204916-20171205162615738-1292598736.png"><meta property="og:image" content="https://git.msft.vip/images/1204916-20171205163026644-674759103.png"><meta property="article:published_time" content="2023-01-31T09:54:24.000Z"><meta property="article:modified_time" content="2024-08-09T12:13:50.165Z"><meta property="article:author" content="Jas0n0ss"><meta property="article:tag" content="ansible"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://git.msft.vip/"><meta name="referrer" content="no-referrer-when-downgrade"><title>Ansible Detailed Tutorial I - git.msft.vip</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom_icon/other/iconfont.css"><link rel="stylesheet" href="/css/custom_icon/phone/iconfont.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"git.msft.vip",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Jas0n0ss</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-shouye"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives"><i class="iconfont icon-guidang"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/tags"><i class="iconfont icon-biaoqian"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/video"><i class="iconfont icon-youtube"></i> <span>视频</span></a></li><li class="nav-item"><a class="nav-link" href="/music"><i class="iconfont icon-tubiaozhizuomobanyihuifu-"></i> <span>音乐</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/code.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Ansible Detailed Tutorial I"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Jas0n0ss </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-01-31 17:54" pubdate>2023年1月31日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 34k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 287 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Ansible Detailed Tutorial I</h1><p class="note note-info">本文最后更新于：2024年8月9日 晚上</p><div class="markdown-body"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="400" height="86" src="//music.163.com/outchain/player?type=2&id=5113327&auto=1&height=66"></iframe>---<h2 id="ansible-简介"><a href="#ansible-简介" class="headerlink" title="ansible 简介"></a>ansible 简介</h2><h3 id="ansible-是什么？"><a href="#ansible-是什么？" class="headerlink" title="ansible 是什么？"></a>ansible 是什么？</h3><p>　　ansible是新出现的自动化运维工具，基于Python开发，集合了众多运维工具（puppet、chef、func、fabric）的优点，实现了批量系统配置、批量程序部署、批量运行命令等功能。<br>　　ansible是基于 paramiko 开发的,并且基于模块化工作，本身没有批量部署的能力。真正具有批量部署的是ansible所运行的模块，ansible只是提供一种框架。ansible不需要在远程主机上安装client&#x2F;agents，因为它们是基于ssh来和远<br>程主机通讯的。ansible目前已经已经被红帽官方收购，是自动化运维工具中大家认可度最高的，并且上手容易，学习简单。是每位运维工程师必须掌握的技能之一。</p><h3 id="ansible-特点"><a href="#ansible-特点" class="headerlink" title="ansible 特点"></a>ansible 特点</h3><ol><li>部署简单，只需在主控端部署Ansible环境，被控端无需做任何操作；</li><li>默认使用SSH协议对设备进行管理；</li><li>有大量常规运维操作模块，可实现日常绝大部分操作；</li><li>配置简单、功能强大、扩展性强；</li><li>支持API及自定义模块，可通过Python轻松扩展；</li><li>通过Playbooks来定制强大的配置、状态管理；</li><li>轻量级，无需在客户端安装agent，更新时，只需在操作机上进行一次更新即可；</li><li>提供一个功能强大、操作性强的Web管理界面和REST API接口——AWX平台。</li></ol><h3 id="ansible-架构图"><a href="#ansible-架构图" class="headerlink" title="ansible 架构图"></a>ansible 架构图</h3><p><img src="/" srcset="/img/loading.gif" lazyload alt="img"><br>　　上图中我们看到的主要模块如下：</p><blockquote><p><code>Ansible</code>：Ansible核心程序。<br><code>HostInventory</code>：记录由Ansible管理的主机信息，包括端口、密码、ip等。<br><code>Playbooks</code>：“剧本”YAML格式文件，多个任务定义在一个文件中，定义主机需要调用哪些模块来完成的功能。<br><code>CoreModules</code>：<strong>核心模块</strong>，主要操作是通过调用核心模块来完成管理任务。<br><code>CustomModules</code>：自定义模块，完成核心模块无法完成的功能，支持多种语言。<br><code>ConnectionPlugins</code>：连接插件，Ansible和Host通信使用</p></blockquote><h2 id="ansible-任务执行"><a href="#ansible-任务执行" class="headerlink" title="ansible 任务执行"></a>ansible 任务执行</h2><h3 id="ansible-任务执行模式"><a href="#ansible-任务执行模式" class="headerlink" title="ansible 任务执行模式"></a>ansible 任务执行模式</h3><p>　　Ansible 系统由控制主机对被管节点的操作方式可分为两类，即<code>adhoc</code>和<code>playbook</code>：</p><ul><li>ad-hoc模式(点对点模式)<br>　　使用单个模块，支持批量执行单条命令。ad-hoc 命令是一种可以快速输入的命令，而且不需要保存起来的命令。<strong>就相当于bash中的一句话shell。</strong></li><li>playbook模式(剧本模式)<br>　　是Ansible主要管理方式，也是Ansible功能强大的关键所在。<strong>playbook通过多个task集合完成一类功能</strong>，如Web服务的安装部署、数据库服务器的批量备份等。可以简单地把playbook理解为通过组合多条ad-hoc操作的配置文件。</li></ul><h3 id="ansible-执行流程"><a href="#ansible-执行流程" class="headerlink" title="ansible 执行流程"></a>ansible 执行流程</h3><p><img src="/../images/1204916-20171205162615738-1292598736.png" srcset="/img/loading.gif" lazyload alt="img"><br>　　简单理解就是Ansible在运行时， 首先读取<code>ansible.cfg</code>中的配置， 根据规则获取<code>Inventory</code>中的管理主机列表， 并行的在这些主机中执行配置的任务， 最后等待执行返回的结果。</p><h3 id="ansible-命令执行过程"><a href="#ansible-命令执行过程" class="headerlink" title="ansible 命令执行过程"></a>ansible 命令执行过程</h3><ol><li>加载自己的配置文件，默认<code>/etc/ansible/ansible.cfg</code>；</li><li>查找对应的主机配置文件，找到要执行的主机或者组；</li><li>加载自己对应的模块文件，如 command；</li><li>通过ansible将模块或命令生成对应的临时py文件(python脚本)， 并将该文件传输至远程服务器；</li><li>对应执行用户的家目录的<code>.ansible/tmp/XXX/XXX.PY</code>文件；</li><li>给文件 +x 执行权限；</li><li>执行并返回结果；</li><li>删除临时py文件，<code>sleep 0</code>退出；</li></ol><h2 id="ansible-配置详解"><a href="#ansible-配置详解" class="headerlink" title="ansible 配置详解"></a>ansible 配置详解</h2><h3 id="ansible-安装方式"><a href="#ansible-安装方式" class="headerlink" title="ansible 安装方式"></a>ansible 安装方式</h3><p>　　ansible安装常用两种方式，<code>yum安装</code>和<code>pip程序安装</code>。下面我们来详细介绍一下这两种安装方式。</p><h4 id="使用-pip（python的包管理模块）安装"><a href="#使用-pip（python的包管理模块）安装" class="headerlink" title="使用 pip（python的包管理模块）安装"></a>使用 pip（python的包管理模块）安装</h4><p>　　首先，我们需要安装一个<code>python-pip</code>包，安装完成以后，则直接使用<code>pip</code>命令来安装我们的包，具体操作过程如下：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">yum <span class="hljs-keyword">install </span>python-pip<br>pip <span class="hljs-keyword">install </span>ansible<br></code></pre></td></tr></table></figure><h4 id="使用-yum-安装"><a href="#使用-yum-安装" class="headerlink" title="使用 yum 安装"></a>使用 yum 安装</h4><p>　　yum 安装是我们很熟悉的安装方式了。我们需要先安装一个<code>epel-release</code>包，然后再安装我们的 ansible 即可。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">yum <span class="hljs-keyword">install </span>epel-release -y<br>yum <span class="hljs-keyword">install </span>ansible –y<br></code></pre></td></tr></table></figure><h3 id="ansible-程序结构"><a href="#ansible-程序结构" class="headerlink" title="ansible 程序结构"></a>ansible 程序结构</h3><p>安装目录如下(yum安装)：<br>　　配置文件目录：&#x2F;etc&#x2F;ansible&#x2F;<br>　　执行文件目录：&#x2F;usr&#x2F;bin&#x2F;<br>　　Lib库依赖目录：&#x2F;usr&#x2F;lib&#x2F;pythonX.X&#x2F;site-packages&#x2F;ansible&#x2F;<br>　　Help文档目录：&#x2F;usr&#x2F;share&#x2F;doc&#x2F;ansible-X.X.X&#x2F;<br>　　Man文档目录：&#x2F;usr&#x2F;share&#x2F;man&#x2F;man1&#x2F;</p><h3 id="ansible配置文件查找顺序"><a href="#ansible配置文件查找顺序" class="headerlink" title="ansible配置文件查找顺序"></a>ansible配置文件查找顺序</h3><p>　　ansible与我们其他的服务在这一点上有很大不同，这里的配置文件查找是从多个地方找的，顺序如下：</p><ol><li>检查环境变量<code>ANSIBLE_CONFIG</code>指向的路径文件(export ANSIBLE_CONFIG&#x3D;&#x2F;etc&#x2F;ansible.cfg)；</li><li><code>~/.ansible.cfg</code>，检查当前目录下的ansible.cfg配置文件；</li><li><code>/etc/ansible.cfg</code>检查etc目录的配置文件。</li></ol><h3 id="ansible配置文件"><a href="#ansible配置文件" class="headerlink" title="ansible配置文件"></a>ansible配置文件</h3><p>　　ansible 的配置文件为<code>/etc/ansible/ansible.cfg</code>，ansible 有许多参数，下面我们列出一些常见的参数：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">inventory</span> = /etc/ansible/hosts		<span class="hljs-comment">#这个参数表示资源清单inventory文件的位置</span><br><span class="hljs-attr">library</span> = /usr/share/ansible		<span class="hljs-comment">#指向存放Ansible模块的目录，支持多个目录方式，只要用冒号（：）隔开就可以</span><br><span class="hljs-attr">forks</span> = <span class="hljs-number">5</span>		<span class="hljs-comment">#并发连接数，默认为5</span><br><span class="hljs-attr">sudo_user</span> = root		<span class="hljs-comment">#设置默认执行命令的用户</span><br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">22</span>		<span class="hljs-comment">#指定连接被管节点的管理端口，默认为22端口，建议修改，能够更加安全</span><br><span class="hljs-attr">host_key_checking</span> = <span class="hljs-literal">False</span>		<span class="hljs-comment">#设置是否检查SSH主机的密钥，值为True/False。关闭后第一次连接不会提示配置实例</span><br><span class="hljs-attr">timeout</span> = <span class="hljs-number">60</span>		<span class="hljs-comment">#设置SSH连接的超时时间，单位为秒</span><br><span class="hljs-attr">log_path</span> = /var/log/ansible.log		<span class="hljs-comment">#指定一个存储ansible日志的文件（默认不记录日志）</span><br></code></pre></td></tr></table></figure><h3 id="ansuble主机清单"><a href="#ansuble主机清单" class="headerlink" title="ansuble主机清单"></a>ansuble主机清单</h3><p>　　在配置文件中，我们提到了资源清单，这个清单就是我们的主机清单，里面保存的是一些 ansible 需要连接管理的主机列表。我们可以来看看他的定义方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs shell">1、正常写法,name1为别名：<br>[test1]<br>name1 ansible_ssh_host=192.168.1.111 ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22<br>name2 ansible_ssh_host=192.168.1.222 ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22<br><br>2、连续的IP写法,表示192.168.1.20到192.168.1.50，共31台主机：<br>[test1]<br>name1 ansible_ssh_host=192.168.1.[20:50] ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22<br><br>3、带参数的群组，vars底下为群组共同便变量，包括已定义变量和自定义变量：<br>[test1]<br>name1 ansible_ssh_host=192.168.1.[20:50]<br>[test1:vars]<br>ansible_ssh_user=root<br>ansible_ssh_pass=&quot;1234&quot;<br>testvar=&quot;test&quot;<br><br>4、群组整合，children底下为父群组test的子群组，调用方式为ansible test -m ping：<br>[dbtest]<br>name1 ansible_ssh_host=192.168.1.[20:50] ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22<br>[webtest]<br>name2 ansible_ssh_host=192.168.2.[20:50] ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22<br>[test:children]<br>dbtest<br>webtest<br><br>5、调用两个主机组的写法，以下webservers和dbservers都会被调用：<br>ansible webservers:dbservers -m win_ping<br><br>6、在webservers组中但不在dbsersers中的调用：<br>ansible webservers:!dbservers -m win_ping<br><br>7、在webservers组中并且在dbservers组中的才会调用：<br>ansible webservers:&amp;dbservers -m win_ping<br><br>8、在调用前加~，代表正则表达式：<br>ansible ~(web|db).*.oss.vip -m win_ping<br><br>9、组合的例子：<br>webserver:dbservers:&amp;nginx:!ntp<br><br>10、hosts文件中没有定义的IP或别名，在进行调用中，会提示错误。ansible对单台服务器的调用，服务器IP或域名必须有写在hosts里<br></code></pre></td></tr></table></figure><h2 id="ansible-常用命令"><a href="#ansible-常用命令" class="headerlink" title="ansible 常用命令"></a>ansible 常用命令</h2><h3 id="ansible-命令集"><a href="#ansible-命令集" class="headerlink" title="ansible 命令集"></a>ansible 命令集</h3><blockquote><p><code>/usr/bin/ansible</code>　　Ansibe AD-Hoc 临时命令执行工具，常用于临时命令的执行<br><code>/usr/bin/ansible-doc</code> 　Ansible 模块功能查看工具<br><code>/usr/bin/ansible-galaxy</code>　　下载&#x2F;上传优秀代码或Roles模块 的官网平台，基于网络的<br><code>/usr/bin/ansible-playbook</code>　　Ansible 定制自动化的任务集编排工具<br><code>/usr/bin/ansible-pull</code>　　Ansible远程执行命令的工具，拉取配置而非推送配置（使用较少，海量机器时使用，对运维的架构能力要求较高）<br><code>/usr/bin/ansible-vault</code>　　Ansible 文件加密工具<br><code>/usr/bin/ansible-console</code>　　Ansible基于Linux Consoble界面可与用户交互的命令执行工具</p></blockquote><p>　　其中，我们比较常用的是<code>/usr/bin/ansible</code>和<code>/usr/bin/ansible-playbook</code>。</p><h3 id="ansible-doc-命令"><a href="#ansible-doc-命令" class="headerlink" title="ansible-doc 命令"></a>ansible-doc 命令</h3><p>　　ansible-doc 命令常用于获取模块信息及其使用帮助，一般用法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-doc -l				<span class="hljs-comment">#获取全部模块的信息</span><br>ansible-doc -s MOD_NAME		<span class="hljs-comment">#获取指定模块的使用帮助</span><br></code></pre></td></tr></table></figure><p>　　我们也可以查看一下ansible-doc的全部用法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@server</span> <span class="hljs-operator">~</span>]# ansible<span class="hljs-operator">-</span>doc<br>Usage: ansible<span class="hljs-operator">-</span>doc [options] [module...]<br><br>Options:<br>  <span class="hljs-operator">-</span>h, <span class="hljs-comment">--help            show this help message and exit　　# 显示命令参数API文档</span><br>  <span class="hljs-operator">-</span>l, <span class="hljs-comment">--list            List available modules　　#列出可用的模块</span><br>  <span class="hljs-operator">-</span>M MODULE_PATH, <span class="hljs-comment">--module-path=MODULE_PATH　　#指定模块的路径</span><br>                        specify path(s) <span class="hljs-keyword">to</span> <span class="hljs-keyword">module</span> library (<span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-keyword">None</span>)<br>  <span class="hljs-operator">-</span>s, <span class="hljs-comment">--snippet         Show playbook snippet for specified module(s)　　#显示playbook制定模块的用法</span><br>  <span class="hljs-operator">-</span>v, <span class="hljs-comment">--verbose         verbose mode (-vvv for more, -vvvv to enable　　# 显示ansible-doc的版本号查看模块列表：</span><br>                        connection debugging)<br>  <span class="hljs-comment">--version             show program&#x27;s version number and exit</span><br></code></pre></td></tr></table></figure><p>　　我们可以来看一下，以mysql相关的为例：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ansible-doc -l |grep mysql</span><br>mysql_db                           Add <span class="hljs-keyword">or</span> <span class="hljs-keyword">remove</span> MySQL databases <span class="hljs-keyword">from</span> a remote...<br>mysql_replication                  Manage MySQL replication                   <br>mysql_user                         Adds <span class="hljs-keyword">or</span> removes a user <span class="hljs-keyword">from</span> a MySQL databas...<br>mysql_variables                    Manage MySQL <span class="hljs-keyword">global</span> variables      <br>[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ansible-doc -s mysql_user</span><br></code></pre></td></tr></table></figure><p><img src="/../images/1204916-20171205163026644-674759103.png" srcset="/img/loading.gif" lazyload alt="img"></p><h3 id="ansible-命令详解"><a href="#ansible-命令详解" class="headerlink" title="ansible 命令详解"></a>ansible 命令详解</h3><p>　　命令的具体格式如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ansible &lt;host-pattern&gt; <span class="hljs-selector-attr">[-f forks]</span> <span class="hljs-selector-attr">[-m module_name]</span> <span class="hljs-selector-attr">[-a args]</span><br></code></pre></td></tr></table></figure><p>　　也可以通过<code>ansible -h</code>来查看帮助，下面我们列出一些比较常用的选项，并解释其含义：</p><blockquote><p><code>-a MODULE_ARGS</code>　　　#模块的参数，如果执行默认COMMAND的模块，即是命令参数，如： “date”，“pwd”等等<br><code>-k</code>，<code>--ask-pass</code> #ask for SSH password。登录密码，提示输入SSH密码而不是假设基于密钥的验证<br><code>--ask-su-pass</code> #ask for su password。su切换密码<br><code>-K</code>，<code>--ask-sudo-pass</code> #ask for sudo password。提示密码使用sudo，sudo表示提权操作<br><code>--ask-vault-pass</code> #ask for vault password。假设我们设定了加密的密码，则用该选项进行访问<br><code>-B SECONDS</code> #后台运行超时时间<br><code>-C</code> #模拟运行环境并进行预运行，可以进行查错测试<br><code>-c CONNECTION</code> #连接类型使用<br><code>-f FORKS</code> #并行任务数，默认为5<br><code>-i INVENTORY</code> #指定主机清单的路径，默认为<code>/etc/ansible/hosts</code><br><code>--list-hosts</code> #查看有哪些主机组<br><code>-m MODULE_NAME</code> #执行模块的名字，默认使用 command 模块，所以如果是只执行单一命令可以不用 -m参数<br><code>-o</code> #压缩输出，尝试将所有结果在一行输出，一般针对收集工具使用<br><code>-S</code> #用 su 命令<br><code>-R SU_USER</code> #指定 su 的用户，默认为 root 用户<br><code>-s</code> #用 sudo 命令<br><code>-U SUDO_USER</code> #指定 sudo 到哪个用户，默认为 root 用户<br><code>-T TIMEOUT</code> #指定 ssh 默认超时时间，默认为10s，也可在配置文件中修改<br><code>-u REMOTE_USER</code> #远程用户，默认为 root 用户<br><code>-v</code> #查看详细信息，同时支持<code>-vvv</code>，<code>-vvvv</code>可查看更详细信息</p></blockquote><h3 id="ansible-配置公私钥"><a href="#ansible-配置公私钥" class="headerlink" title="ansible 配置公私钥"></a>ansible 配置公私钥</h3><p>　　上面我们已经提到过 ansible 是基于 ssh 协议实现的，所以其配置公私钥的方式与 ssh 协议的方式相同，具体操作步骤如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#1.生成私钥</span><br>[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ssh-keygen </span><br><span class="hljs-meta">#2.向主机分发私钥</span><br>[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ssh-copy-id root@192.168.37.122</span><br>[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ssh-copy-id root@192.168.37.133</span><br></code></pre></td></tr></table></figure><p>　　这样的话，就可以实现无密码登录，我们的实验过程也会顺畅很多。</p><h2 id="ansible-常用模块"><a href="#ansible-常用模块" class="headerlink" title="ansible 常用模块"></a>ansible 常用模块</h2><h3 id="1）主机连通性测试"><a href="#1）主机连通性测试" class="headerlink" title="1）主机连通性测试"></a>1）主机连通性测试</h3><p>　　我们使用<code>ansible web -m ping</code>命令来进行主机连通性测试，效果如下：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m ping</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　这样就说明我们的主机是连通状态的。接下来的操作才可以正常进行。</p><h3 id="2）command-模块"><a href="#2）command-模块" class="headerlink" title="2）command 模块"></a>2）command 模块</h3><p>　　这个模块可以直接在远程主机上执行命令，并将结果返回本主机。<br>　　举例如下：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m command -a &#x27;ss -ntl&#x27;</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> |<span class="hljs-params"> SUCCESS </span>| rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-title class_">State</span>      <span class="hljs-title class_">Recv</span>-Q <span class="hljs-title class_">Send</span>-Q <span class="hljs-title class_">Local</span> <span class="hljs-title class_">Address</span><span class="hljs-symbol">:Port</span>               <span class="hljs-title class_">Peer</span> <span class="hljs-title class_">Address</span><span class="hljs-symbol">:Port</span>              <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *<span class="hljs-symbol">:</span><span class="hljs-number">111</span>                      *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">5</span>      <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span><span class="hljs-symbol">:</span><span class="hljs-number">53</span>                       *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *<span class="hljs-symbol">:</span><span class="hljs-number">22</span>                       *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>    <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">631</span>                      *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *<span class="hljs-symbol">:</span><span class="hljs-number">23000</span>                    *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>    <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                       *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>         <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">111</span>                     <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>         <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">22</span>                      <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>        <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">631</span>                     <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>        <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                      <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> |<span class="hljs-params"> SUCCESS </span>| rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-title class_">State</span>      <span class="hljs-title class_">Recv</span>-Q <span class="hljs-title class_">Send</span>-Q <span class="hljs-title class_">Local</span> <span class="hljs-title class_">Address</span><span class="hljs-symbol">:Port</span>               <span class="hljs-title class_">Peer</span> <span class="hljs-title class_">Address</span><span class="hljs-symbol">:Port</span>              <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *<span class="hljs-symbol">:</span><span class="hljs-number">111</span>                      *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *<span class="hljs-symbol">:</span><span class="hljs-number">22</span>                       *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>    <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">631</span>                      *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *<span class="hljs-symbol">:</span><span class="hljs-number">23000</span>                    *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>    <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                       *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>         <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">111</span>                     <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>         <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">22</span>                      <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>        <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">631</span>                     <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>                  <br><span class="hljs-variable constant_">LISTEN</span>     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>        <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                      <span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:*</span>  <br></code></pre></td></tr></table></figure><p>　　命令模块接受命令名称，后面是空格分隔的列表参数。给定的命令将在所有选定的节点上执行。它不会通过shell进行处理，比如$HOME和操作如”&lt;”，”&gt;”，”|”，”;”，”&amp;” 工作（需要使用（shell）模块实现这些功能）。注意，该命令不支持<code>| 管道命令</code>。<br>　　下面来看一看该模块下常用的几个命令：</p><blockquote><p>chdir　　　　　　 # 在执行命令之前，先切换到该目录<br>executable # 切换shell来执行命令，需要使用命令的绝对路径<br>free_form 　 # 要执行的Linux指令，一般使用Ansible的-a参数代替。<br>creates 　# 一个文件名，当这个文件存在，则该命令不执行,可以<br>用来做判断<br>removes # 一个文件名，这个文件不存在，则该命令不执行</p></blockquote><p>　　下面我们来看看这些命令的执行效果：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[root@server ~]<span class="hljs-comment"># ansible web -m command -a &#x27;chdir=/data/ ls&#x27;	#先切换到/data/ 目录，再执行“ls”命令</span><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">122</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>aaa.<span class="hljs-keyword">jpg</span><br><span class="hljs-keyword"></span>fastdfs<br>mogdata<br>tmp<br>web<br>wKgleloeYoCAMLtZAAAWEekAtkc497.<span class="hljs-keyword">jpg</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">133</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>aaa.<span class="hljs-keyword">jpg</span><br><span class="hljs-keyword"></span>fastdfs<br>mogdata<br>tmp<br>web<br>wKgleloeYoCAMLtZAAAWEekAtkc497.<span class="hljs-keyword">jpg</span><br><span class="hljs-keyword"></span>[root@server ~]<span class="hljs-comment"># ansible web -m command -a &#x27;creates=/data/aaa.jpg ls&#x27;		#如果/data/aaa.jpg存在，则不执行“ls”命令</span><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">122</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>skipped, since /data/aaa.<span class="hljs-keyword">jpg </span>exists<br><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">133</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>skipped, since /data/aaa.<span class="hljs-keyword">jpg </span>exists<br>[root@server ~]<span class="hljs-comment"># ansible web -m command -a &#x27;removes=/data/aaa.jpg cat /data/a&#x27;		#如果/data/aaa.jpg存在，则执行“cat /data/a”命令</span><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">122</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>hello<br><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">133</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>hello<br></code></pre></td></tr></table></figure><h3 id="3）shell-模块"><a href="#3）shell-模块" class="headerlink" title="3）shell 模块"></a>3）shell 模块</h3><p>　　shell模块可以在远程主机上调用shell解释器运行命令，支持shell的各种功能，例如管道等。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;cat /etc/passwd |grep &quot;keer&quot;&#x27;</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> |<span class="hljs-params"> SUCCESS </span>| rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-symbol">keer:</span><span class="hljs-symbol">x:</span><span class="hljs-number">10001</span><span class="hljs-symbol">:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:keer</span><span class="hljs-symbol">:/home/keer</span><span class="hljs-symbol">:/bin/sh</span><br><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> |<span class="hljs-params"> SUCCESS </span>| rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-symbol">keer:</span><span class="hljs-symbol">x:</span><span class="hljs-number">10001</span><span class="hljs-symbol">:</span><span class="hljs-number">10001</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/home/keer</span><span class="hljs-symbol">:/bin/sh</span><br></code></pre></td></tr></table></figure><p>　　只要是我们的shell命令，都可以通过这个模块在远程主机上运行，这里就不一一举例了。</p><h3 id="4）copy-模块"><a href="#4）copy-模块" class="headerlink" title="4）copy 模块"></a>4）copy 模块</h3><p>　　这个模块用于将文件复制到远程主机，同时支持给定内容生成文件和修改权限等。<br>　　其相关选项如下：</p><blockquote><p><code>src</code>　　　　#被复制到远程主机的本地文件。可以是绝对路径，也可以是相对路径。如果路径是一个目录，则会递归复制，用法类似于”rsync”<br><code>content</code>　　　#用于替换”src”，可以直接指定文件的值<br><code>dest</code>　　　　#必选项，将源文件复制到的远程主机的<strong>绝对路径</strong><br><code>backup</code>　　　#当文件内容发生改变后，在覆盖之前把源文件备份，备份文件包含时间信息<br><code>directory_mode</code>　　　　#递归设定目录的权限，默认为系统默认权限<br><code>force</code>　　　　#当目标主机包含该文件，但内容不同时，设为”yes”，表示强制覆盖；设为”no”，表示目标主机的目标位置不存在该文件才复制。默认为”yes”<br><code>others</code>　　　　#所有的 file 模块中的选项可以在这里使用</p></blockquote><p>用法举例如下：<br><strong>① 复制文件：</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m copy -a &#x27;src=~/hello dest=/data/hello&#x27; </span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;22596363b3de40b06f981fb85d82312e8c0ed511&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/hello&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;6f5902ac237024bdd0c176cb93063dc4&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0644&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">12</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/root/.ansible/tmp/ansible-tmp-1512437093.55-228281064292921/source&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;file&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;22596363b3de40b06f981fb85d82312e8c0ed511&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/hello&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;6f5902ac237024bdd0c176cb93063dc4&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0644&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">12</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/root/.ansible/tmp/ansible-tmp-1512437093.74-44694985235189/source&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;file&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>② 给定内容生成文件，并制定权限</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m copy -a &#x27;content=&quot;I am keer\n&quot; dest=/data/name mode=666&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;0421570938940ea784f9d8598dab87f07685b968&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/name&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;497fa8386590a5fc89090725b07f175c&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0666&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">10</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/root/.ansible/tmp/ansible-tmp-1512437327.37-199512601767687/source&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;file&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;0421570938940ea784f9d8598dab87f07685b968&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/name&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;497fa8386590a5fc89090725b07f175c&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0666&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">10</span>, <br>	    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/root/.ansible/tmp/ansible-tmp-1512437327.55-218104039503110/source&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;file&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们现在可以去查看一下我们生成的文件及其权限：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@server</span> <span class="hljs-operator">~</span>]# ansible web <span class="hljs-operator">-</span>m shell <span class="hljs-operator">-</span>a <span class="hljs-string">&#x27;ls -l /data/&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> <span class="hljs-operator">|</span> SUCCESS <span class="hljs-operator">|</span> rc<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-operator">&gt;&gt;</span><br>total <span class="hljs-number">28</span><br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>   <span class="hljs-number">1</span> root root   <span class="hljs-number">12</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">6</span> <span class="hljs-number">09</span>:<span class="hljs-number">45</span> name<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> <span class="hljs-operator">|</span> SUCCESS <span class="hljs-operator">|</span> rc<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-operator">&gt;&gt;</span><br>total <span class="hljs-number">40</span><br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span> <span class="hljs-number">1</span> root     root       <span class="hljs-number">12</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">5</span> <span class="hljs-number">09</span>:<span class="hljs-number">45</span> name<br></code></pre></td></tr></table></figure><p>　　可以看出我们的name文件已经生成，并且权限为666。<br><strong>③ 关于覆盖</strong><br>　　我们把文件的内容修改一下，然后选择覆盖备份：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m copy -a &#x27;content=&quot;I am keerya\n&quot; backup=yes dest=/data/name mode=666&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;backup_file&quot;</span>: <span class="hljs-string">&quot;/data/name.4394.2017-12-06@09:46:25~&quot;</span>, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;064a68908ab9971ee85dbc08ea038387598e3778&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/name&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;8ca7c11385856155af52e560f608891c&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0666&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">12</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/root/.ansible/tmp/ansible-tmp-1512438383.78-228128616784888/source&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;file&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;backup_file&quot;</span>: <span class="hljs-string">&quot;/data/name.5962.2017-12-05@09:46:24~&quot;</span>, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;064a68908ab9971ee85dbc08ea038387598e3778&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/name&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;8ca7c11385856155af52e560f608891c&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0666&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">12</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/root/.ansible/tmp/ansible-tmp-1512438384.0-170718946740009/source&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;file&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　现在我们可以去查看一下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@server</span> <span class="hljs-operator">~</span>]# ansible web <span class="hljs-operator">-</span>m shell <span class="hljs-operator">-</span>a <span class="hljs-string">&#x27;ls -l /data/&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> <span class="hljs-operator">|</span> SUCCESS <span class="hljs-operator">|</span> rc<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-operator">&gt;&gt;</span><br>total <span class="hljs-number">28</span><br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>   <span class="hljs-number">1</span> root root   <span class="hljs-number">12</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">6</span> <span class="hljs-number">09</span>:<span class="hljs-number">46</span> name<br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>   <span class="hljs-number">1</span> root root   <span class="hljs-number">10</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">6</span> <span class="hljs-number">09</span>:<span class="hljs-number">45</span> name<span class="hljs-number">.4394</span><span class="hljs-number">.2017</span><span class="hljs-number">-12</span><span class="hljs-number">-06</span><span class="hljs-variable">@09</span>:<span class="hljs-number">46</span>:<span class="hljs-number">25</span><span class="hljs-operator">~</span><br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> <span class="hljs-operator">|</span> SUCCESS <span class="hljs-operator">|</span> rc<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-operator">&gt;&gt;</span><br>total <span class="hljs-number">40</span><br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span> <span class="hljs-number">1</span> root     root       <span class="hljs-number">12</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">5</span> <span class="hljs-number">09</span>:<span class="hljs-number">46</span> name<br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span> <span class="hljs-number">1</span> root     root       <span class="hljs-number">10</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">5</span> <span class="hljs-number">09</span>:<span class="hljs-number">45</span> name<span class="hljs-number">.5962</span><span class="hljs-number">.2017</span><span class="hljs-number">-12</span><span class="hljs-number">-05</span><span class="hljs-variable">@09</span>:<span class="hljs-number">46</span>:<span class="hljs-number">24</span><span class="hljs-operator">~</span><br></code></pre></td></tr></table></figure><p>　　可以看出，我们的源文件已经被备份，我们还可以查看一下<code>name</code>文件的内容：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ansible web -m shell -a &#x27;cat /data/name&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br>I am keerya<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br>I am keerya<br></code></pre></td></tr></table></figure><p>　　证明，这正是我们新导入的文件的内容。</p><h3 id="5）file-模块"><a href="#5）file-模块" class="headerlink" title="5）file 模块"></a>5）file 模块</h3><p>　　该模块主要用于设置文件的属性，比如创建文件、创建链接文件、删除文件等。<br>　　下面是一些常见的命令：</p><blockquote><p><code>force</code>　　#需要在两种情况下强制创建软链接，一种是源文件不存在，但之后会建立的情况下；另一种是目标软链接已存在，需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no<br><code>group</code>　　#定义文件&#x2F;目录的属组。后面可以加上<code>mode</code>：定义文件&#x2F;目录的权限<br><code>owner</code>　　#定义文件&#x2F;目录的属主。后面必须跟上<code>path</code>：定义文件&#x2F;目录的路径<br><code>recurse</code>　　#递归设置文件的属性，只对目录有效，后面跟上<code>src</code>：被链接的源文件路径，只应用于<code>state=link</code>的情况<br><code>dest</code>　　#被链接到的路径，只应用于<code>state=link</code>的情况<br><code>state</code>　　#状态，有以下选项：</p><blockquote><p><code>directory</code>：如果目录不存在，就创建目录<br><code>file</code>：即使文件不存在，也不会被创建<br><code>link</code>：创建软链接<br><code>hard</code>：创建硬链接<br><code>touch</code>：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间<br><code>absent</code>：删除目录、文件或者取消链接文件</p></blockquote></blockquote><p>　　用法举例如下：<br><strong>① 创建目录：</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m file -a &#x27;path=/data/app state=directory&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0755&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/data/app&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">6</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;directory&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0755&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/data/app&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">4096</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;directory&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以查看一下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@server</span> <span class="hljs-operator">~</span>]# ansible web <span class="hljs-operator">-</span>m shell <span class="hljs-operator">-</span>a <span class="hljs-string">&#x27;ls -l /data&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> <span class="hljs-operator">|</span> SUCCESS <span class="hljs-operator">|</span> rc<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-operator">&gt;&gt;</span><br>total <span class="hljs-number">28</span><br>drwxr<span class="hljs-operator">-</span>xr<span class="hljs-operator">-</span>x   <span class="hljs-number">2</span> root root    <span class="hljs-number">6</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">6</span> <span class="hljs-number">10</span>:<span class="hljs-number">21</span> app<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> <span class="hljs-operator">|</span> SUCCESS <span class="hljs-operator">|</span> rc<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-operator">&gt;&gt;</span><br>total <span class="hljs-number">44</span><br>drwxr<span class="hljs-operator">-</span>xr<span class="hljs-operator">-</span>x <span class="hljs-number">2</span> root     root     <span class="hljs-number">4096</span> <span class="hljs-type">Dec</span>  <span class="hljs-number">5</span> <span class="hljs-number">10</span>:<span class="hljs-number">21</span> app<br></code></pre></td></tr></table></figure><p>　　可以看出，我们的目录已经创建完成。<br><strong>② 创建链接文件</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m file -a &#x27;path=/data/bbb.jpg src=aaa.jpg state=link&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/bbb.jpg&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0777&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">7</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;aaa.jpg&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;link&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/bbb.jpg&quot;</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;group&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;0777&quot;</span>, <br>    <span class="hljs-string">&quot;owner&quot;</span>: <span class="hljs-string">&quot;root&quot;</span>, <br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">7</span>, <br>    <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;aaa.jpg&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;link&quot;</span>, <br>    <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以去查看一下：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">[root@server ~]# ansible web -m shell -a <span class="hljs-string">&#x27;ls -l /data&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br>total <span class="hljs-number">28</span><br>-rw-r--r--   <span class="hljs-number">1</span> root root <span class="hljs-number">5649</span> <span class="hljs-keyword">Dec</span>  <span class="hljs-number">5</span> <span class="hljs-number">13</span>:<span class="hljs-number">49</span> <span class="hljs-keyword">aaa</span><span class="hljs-number">.</span>jpg<br>lrwxrwxrwx   <span class="hljs-number">1</span> root root    <span class="hljs-number">7</span> <span class="hljs-keyword">Dec</span>  <span class="hljs-number">6</span> <span class="hljs-number">10</span>:<span class="hljs-number">25</span> bbb<span class="hljs-number">.</span>jpg -&gt; <span class="hljs-keyword">aaa</span><span class="hljs-number">.</span>jpg<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br>total <span class="hljs-number">44</span><br>-rw-r--r-- <span class="hljs-number">1</span> root     root     <span class="hljs-number">5649</span> <span class="hljs-keyword">Dec</span>  <span class="hljs-number">4</span> <span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-keyword">aaa</span><span class="hljs-number">.</span>jpg<br>lrwxrwxrwx <span class="hljs-number">1</span> root     root        <span class="hljs-number">7</span> <span class="hljs-keyword">Dec</span>  <span class="hljs-number">5</span> <span class="hljs-number">10</span>:<span class="hljs-number">25</span> bbb<span class="hljs-number">.</span>jpg -&gt; <span class="hljs-keyword">aaa</span><span class="hljs-number">.</span>jpg<br></code></pre></td></tr></table></figure><p>　　我们的链接文件已经创建成功。<br><strong>③ 删除文件</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m file -a &#x27;path=/data/a state=absent&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/data/a&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;absent&quot;</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/data/a&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;absent&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以查看一下：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haskell">[root@server ~]# ansible web -m shell -a &#x27;ls /<span class="hljs-class"><span class="hljs-keyword">data</span>/a&#x27;</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> | <span class="hljs-type">FAILED</span> | rc=<span class="hljs-number">2</span> &gt;&gt;<br><span class="hljs-title">ls</span>: cannot access /<span class="hljs-class"><span class="hljs-keyword">data</span>/a: <span class="hljs-type">No</span> such file or directory</span><br><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> | <span class="hljs-type">FAILED</span> | rc=<span class="hljs-number">2</span> &gt;&gt;<br><span class="hljs-title">ls</span>: cannot access /<span class="hljs-class"><span class="hljs-keyword">data</span>/a: <span class="hljs-type">No</span> such file or directory</span><br></code></pre></td></tr></table></figure><p>　　发现已经没有这个文件了。 　　</p><h3 id="6）fetch-模块"><a href="#6）fetch-模块" class="headerlink" title="6）fetch 模块"></a>6）fetch 模块</h3><p>　　该模块用于从远程某主机获取（复制）文件到本地。<br>　　有两个选项：</p><blockquote><p><code>dest</code>：用来存放文件的目录<br><code>src</code>：在远程拉取的文件，并且必须是一个<strong>file</strong>，不能是<strong>目录</strong></p></blockquote><p>　　具体举例如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart">[root<span class="hljs-meta">@server</span> ~]# ansible web -m fetch -a <span class="hljs-string">&#x27;src=/data/hello dest=/data&#x27;</span>  <br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;22596363b3de40b06f981fb85d82312e8c0ed511&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/192.168.37.122/data/hello&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;6f5902ac237024bdd0c176cb93063dc4&quot;</span>, <br>    <span class="hljs-string">&quot;remote_checksum&quot;</span>: <span class="hljs-string">&quot;22596363b3de40b06f981fb85d82312e8c0ed511&quot;</span>, <br>    <span class="hljs-string">&quot;remote_md5sum&quot;</span>: <span class="hljs-keyword">null</span><br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;checksum&quot;</span>: <span class="hljs-string">&quot;22596363b3de40b06f981fb85d82312e8c0ed511&quot;</span>, <br>    <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/data/192.168.37.133/data/hello&quot;</span>, <br>    <span class="hljs-string">&quot;md5sum&quot;</span>: <span class="hljs-string">&quot;6f5902ac237024bdd0c176cb93063dc4&quot;</span>, <br>    <span class="hljs-string">&quot;remote_checksum&quot;</span>: <span class="hljs-string">&quot;22596363b3de40b06f981fb85d82312e8c0ed511&quot;</span>, <br>    <span class="hljs-string">&quot;remote_md5sum&quot;</span>: <span class="hljs-keyword">null</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以在本机上查看一下文件是否复制成功。要注意，文件保存的路径是我们设置的接收目录下的<code>被管制主机ip</code>目录下：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs haskell">[root@server ~]# cd /<span class="hljs-class"><span class="hljs-keyword">data</span>/</span><br>[root@server <span class="hljs-class"><span class="hljs-keyword">data</span>]# ls</span><br><span class="hljs-number">1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span>  fastdfs  web<br>[root@server <span class="hljs-class"><span class="hljs-keyword">data</span>]# cd 192.168.37.122</span><br>[root@server <span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span>]# ls<br><span class="hljs-class"><span class="hljs-keyword">data</span></span><br>[root@server <span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span>]# cd <span class="hljs-class"><span class="hljs-keyword">data</span>/</span><br>[root@server <span class="hljs-class"><span class="hljs-keyword">data</span>]# ls</span><br><span class="hljs-title">hello</span><br>[root@server <span class="hljs-class"><span class="hljs-keyword">data</span>]# pwd</span><br>/<span class="hljs-class"><span class="hljs-keyword">data</span>/192.168.37.122/<span class="hljs-keyword">data</span></span><br></code></pre></td></tr></table></figure><h3 id="7）cron-模块"><a href="#7）cron-模块" class="headerlink" title="7）cron 模块"></a>7）cron 模块</h3><p>　　该模块适用于管理<code>cron</code>计划任务的。<br>　　其使用的语法跟我们的<code>crontab</code>文件中的语法一致，同时，可以指定以下选项：</p><blockquote><p><code>day=</code> #日应该运行的工作( 1-31, *, *&#x2F;2, )<br><code>hour=</code> # 小时 ( 0-23, *, *&#x2F;2, )<br><code>minute=</code> #分钟( 0-59, *, *&#x2F;2, )<br><code>month=</code> # 月( 1-12, *, &#x2F;2, )<br><code>weekday=</code> # 周 ( 0-6 for Sunday-Saturday,, )<br><code>job=</code> #指明运行的命令是什么<br><code>name=</code> #定时任务描述<br><code>reboot</code> # 任务在重启时运行，不建议使用，建议使用special_time<br><code>special_time</code> #特殊的时间范围，参数：reboot（重启时），annually（每年），monthly（每月），weekly（每周），daily（每天），hourly（每小时）<br><code>state</code> #指定状态，present表示添加定时任务，也是默认设置，absent表示删除定时任务<br><code>user</code> # 以哪个用户的身份执行</p></blockquote><p>　　举例如下：<br><strong>① 添加计划任务</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m cron -a &#x27;name=&quot;ntp update every 5 min&quot; minute=*/5 job=&quot;/sbin/ntpdate 172.17.0.1 &amp;&gt; /dev/null&quot;&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;envs&quot;</span>: [], <br>    <span class="hljs-string">&quot;jobs&quot;</span>: [<br>        <span class="hljs-string">&quot;ntp update every 5 min&quot;</span><br>    ]<br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;envs&quot;</span>: [], <br>    <span class="hljs-string">&quot;jobs&quot;</span>: [<br>        <span class="hljs-string">&quot;ntp update every 5 min&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以去查看一下：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root@server ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;crontab -l&#x27;</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-comment">#Ansible: ntp update every 5 min</span><br>*<span class="hljs-regexp">/5 * * * * /s</span>bin/ntpdate <span class="hljs-number">172.17</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> &amp;&gt; <span class="hljs-regexp">/dev/null</span><br><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-comment">#Ansible: ntp update every 5 min</span><br>*<span class="hljs-regexp">/5 * * * * /s</span>bin/ntpdate <span class="hljs-number">172.17</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> &amp;&gt; <span class="hljs-regexp">/dev/null</span><br></code></pre></td></tr></table></figure><p>　　可以看出，我们的计划任务已经设置成功了。<br><strong>② 删除计划任务</strong><br>　　如果我们的计划任务添加错误，想要删除的话，则执行以下操作：<br>　　首先我们查看一下现有的计划任务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;crontab -l&#x27;</span><br>192.168.37.122 | SUCCESS | rc=0 &gt;&gt;<br><span class="hljs-comment">#Ansible: ntp update every 5 min</span><br>*/5 * * * * /sbin/ntpdate 172.17.0.1 &amp;&gt; /dev/null<br><span class="hljs-comment">#Ansible: df everyday</span><br>* 15 * * * <span class="hljs-built_in">df</span> -lh &gt;&gt; /tmp/disk_total &amp;&gt; /dev/null<br><br>192.168.37.133 | SUCCESS | rc=0 &gt;&gt;<br><span class="hljs-comment">#Ansible: ntp update every 5 min</span><br>*/5 * * * * /sbin/ntpdate 172.17.0.1 &amp;&gt; /dev/null<br><span class="hljs-comment">#Ansible: df everyday</span><br>* 15 * * * <span class="hljs-built_in">df</span> -lh &gt;&gt; /tmp/disk_total &amp;&gt; /dev/null<br></code></pre></td></tr></table></figure><p>　　然后执行删除操作：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m cron -a &#x27;name=&quot;df everyday&quot; hour=15 job=&quot;df -lh &gt;&gt; /tmp/disk_total &amp;&gt; /dev/null&quot; state=absent&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;envs&quot;</span>: [], <br>    <span class="hljs-string">&quot;jobs&quot;</span>: [<br>        <span class="hljs-string">&quot;ntp update every 5 min&quot;</span><br>    ]<br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;envs&quot;</span>: [], <br>    <span class="hljs-string">&quot;jobs&quot;</span>: [<br>        <span class="hljs-string">&quot;ntp update every 5 min&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>　　删除完成后，我们再查看一下现有的计划任务确认一下：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root@server ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;crontab -l&#x27;</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-comment">#Ansible: ntp update every 5 min</span><br>*<span class="hljs-regexp">/5 * * * * /s</span>bin/ntpdate <span class="hljs-number">172.17</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> &amp;&gt; <span class="hljs-regexp">/dev/null</span><br><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> | SUCCESS | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-comment">#Ansible: ntp update every 5 min</span><br>*<span class="hljs-regexp">/5 * * * * /s</span>bin/ntpdate <span class="hljs-number">172.17</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> &amp;&gt; <span class="hljs-regexp">/dev/null</span><br></code></pre></td></tr></table></figure><p>　　我们的删除操作已经成功。</p><h3 id="8）yum-模块"><a href="#8）yum-模块" class="headerlink" title="8）yum 模块"></a>8）yum 模块</h3><p>　　顾名思义，该模块主要用于软件的安装。<br>　　其选项如下：</p><blockquote><p><code>name=</code>　　#所安装的包的名称<br><code>state=</code>　　#<code>present</code>—&gt;安装， <code>latest</code>—&gt;安装最新的, <code>absent</code>—&gt; 卸载软件。<br><code>update_cache</code>　　#强制更新yum的缓存<br><code>conf_file</code>　　#指定远程yum安装时所依赖的配置文件（安装本地已有的包）。<br><code>disable_pgp_check</code>　　#是否禁止GPG checking，只用于<code>present</code>or <code>latest</code>。<br><code>disablerepo</code>　　#临时禁止使用yum库。 只用于安装或更新时。<br><code>enablerepo</code>　　#临时使用的yum库。只用于安装或更新时。</p></blockquote><p>　　下面我们就来安装一个包试试看：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs swift">[root<span class="hljs-meta">@server</span> <span class="hljs-operator">~</span>]# ansible web <span class="hljs-operator">-</span>m yum <span class="hljs-operator">-</span>a &#x27;name<span class="hljs-operator">=</span>htop state<span class="hljs-operator">=</span>present&#x27;<br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> <span class="hljs-operator">|</span> <span class="hljs-type">SUCCESS</span> <span class="hljs-operator">=&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;&quot;</span>, <br>    <span class="hljs-string">&quot;rc&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;results&quot;</span>: [<br>        <span class="hljs-string">&quot;Loaded plugins: fastestmirror, langpacks<span class="hljs-subst">\n</span>Loading mirror speeds from cached hostfile<span class="hljs-subst">\n</span>Resolving Dependencies<span class="hljs-subst">\n</span>--&gt; Running transaction check<span class="hljs-subst">\n</span>---&gt; Package htop.x86_64 0:2.0.2-1.el7 will be installed<span class="hljs-subst">\n</span>--&gt; Finished Dependency Resolution<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Dependencies Resolved<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>================================================================================<span class="hljs-subst">\n</span> Package         Arch              Version                Repository       Size<span class="hljs-subst">\n</span>================================================================================<span class="hljs-subst">\n</span>Installing:<span class="hljs-subst">\n</span> htop            x86_64            2.0.2-1.el7            epel             98 k<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Transaction Summary<span class="hljs-subst">\n</span>================================================================================<span class="hljs-subst">\n</span>Install  1 Package<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Total download size: 98 k<span class="hljs-subst">\n</span>Installed size: 207 k<span class="hljs-subst">\n</span>Downloading packages:<span class="hljs-subst">\n</span>Running transaction check<span class="hljs-subst">\n</span>Running transaction test<span class="hljs-subst">\n</span>Transaction test succeeded<span class="hljs-subst">\n</span>Running transaction<span class="hljs-subst">\n</span>  Installing : htop-2.0.2-1.el7.x86_64                                      1/1 <span class="hljs-subst">\n</span>  Verifying  : htop-2.0.2-1.el7.x86_64                                      1/1 <span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Installed:<span class="hljs-subst">\n</span>  htop.x86_64 0:2.0.2-1.el7                                                     <span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Complete!<span class="hljs-subst">\n</span>&quot;</span><br>    ]<br>&#125;<br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> <span class="hljs-operator">|</span> <span class="hljs-type">SUCCESS</span> <span class="hljs-operator">=&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Warning: RPMDB altered outside of yum.<span class="hljs-subst">\n</span>** Found 3 pre-existing rpmdb problem(s), &#x27;yum check&#x27; output follows:<span class="hljs-subst">\n</span>ipa-client-4.4.0-12.el7.centos.x86_64 has installed conflicts freeipa-client: ipa-client-4.4.0-12.el7.centos.x86_64<span class="hljs-subst">\n</span>ipa-client-common-4.4.0-12.el7.centos.noarch has installed conflicts freeipa-client-common: ipa-client-common-4.4.0-12.el7.centos.noarch<span class="hljs-subst">\n</span>ipa-common-4.4.0-12.el7.centos.noarch has installed conflicts freeipa-common: ipa-common-4.4.0-12.el7.centos.noarch<span class="hljs-subst">\n</span>&quot;</span>, <br>    <span class="hljs-string">&quot;rc&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;results&quot;</span>: [<br>        <span class="hljs-string">&quot;Loaded plugins: fastestmirror, langpacks<span class="hljs-subst">\n</span>Loading mirror speeds from cached hostfile<span class="hljs-subst">\n</span>Resolving Dependencies<span class="hljs-subst">\n</span>--&gt; Running transaction check<span class="hljs-subst">\n</span>---&gt; Package htop.x86_64 0:2.0.2-1.el7 will be installed<span class="hljs-subst">\n</span>--&gt; Finished Dependency Resolution<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Dependencies Resolved<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>================================================================================<span class="hljs-subst">\n</span> Package         Arch              Version                Repository       Size<span class="hljs-subst">\n</span>================================================================================<span class="hljs-subst">\n</span>Installing:<span class="hljs-subst">\n</span> htop            x86_64            2.0.2-1.el7            epel             98 k<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Transaction Summary<span class="hljs-subst">\n</span>================================================================================<span class="hljs-subst">\n</span>Install  1 Package<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Total download size: 98 k<span class="hljs-subst">\n</span>Installed size: 207 k<span class="hljs-subst">\n</span>Downloading packages:<span class="hljs-subst">\n</span>Running transaction check<span class="hljs-subst">\n</span>Running transaction test<span class="hljs-subst">\n</span>Transaction test succeeded<span class="hljs-subst">\n</span>Running transaction<span class="hljs-subst">\n</span>  Installing : htop-2.0.2-1.el7.x86_64                                      1/1 <span class="hljs-subst">\n</span>  Verifying  : htop-2.0.2-1.el7.x86_64                                      1/1 <span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Installed:<span class="hljs-subst">\n</span>  htop.x86_64 0:2.0.2-1.el7                                                     <span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>Complete!<span class="hljs-subst">\n</span>&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>　　安装成功。</p><h3 id="9）service-模块"><a href="#9）service-模块" class="headerlink" title="9）service 模块"></a>9）service 模块</h3><p>　　该模块用于服务程序的管理。<br>　　其主要选项如下：</p><blockquote><p><code>arguments</code> #命令行提供额外的参数<br><code>enabled</code> #设置开机启动。<br><code>name=</code> #服务名称<br><code>runlevel</code> #开机启动的级别，一般不用指定。<br><code>sleep</code> #在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。(定义在剧本中。)<br><code>state</code> #有四种状态，分别为：<code>started</code>—&gt;启动服务， <code>stopped</code>—&gt;停止服务， <code>restarted</code>—&gt;重启服务， <code>reloaded</code>—&gt;重载配置</p></blockquote><p>　　下面是一些例子：<br><strong>① 开启服务并设置自启动</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart">[root<span class="hljs-meta">@server</span> ~]# ansible web -m service -a <span class="hljs-string">&#x27;name=nginx state=started enabled=true&#x27;</span> <br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;enabled&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;nginx&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;started&quot;</span>, <br>    ……<br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;enabled&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;nginx&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;started&quot;</span>, <br>    ……<br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以去查看一下端口是否打开：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[root@server ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;ss -ntl&#x27;</span><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">122</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>State      Recv-Q Send-Q Local <span class="hljs-keyword">Address:Port </span>              Peer <span class="hljs-keyword">Address:Port </span>             <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *:<span class="hljs-number">80</span>                       *:*                                  <br><br><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">37</span>.<span class="hljs-number">133</span> <span class="hljs-title">| SUCCESS |</span> rc=<span class="hljs-number">0</span> &gt;&gt;<br>State      Recv-Q Send-Q Local <span class="hljs-keyword">Address:Port </span>              Peer <span class="hljs-keyword">Address:Port </span>                   <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>          *:<span class="hljs-number">80</span>                       *:*                  <br></code></pre></td></tr></table></figure><p>　　可以看出我们的80端口已经打开。<br><strong>② 关闭服务</strong><br>　　我们也可以通过该模块来关闭我们的服务：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m service -a &#x27;name=nginx state=stopped&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;nginx&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;stopped&quot;</span>, <br>	……<br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;nginx&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;stopped&quot;</span>, <br>	……<br>&#125;<br></code></pre></td></tr></table></figure><p>　　一样的，我们来查看一下端口：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ansible web -m shell -a &#x27;ss -ntl | grep 80&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | FAILED | rc=<span class="hljs-number">1</span> &gt;&gt;<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | FAILED | rc=<span class="hljs-number">1</span> &gt;&gt;<br></code></pre></td></tr></table></figure><p>　　可以看出，我们已经没有80端口了，说明我们的nginx服务已经关闭了。</p><h3 id="10）user-模块"><a href="#10）user-模块" class="headerlink" title="10）user 模块"></a>10）user 模块</h3><p>　　该模块主要是用来管理用户账号。<br>　　其主要选项如下：</p><blockquote><p><code>comment</code>　　# 用户的描述信息<br><code>createhome</code>　　# 是否创建家目录<br><code>force</code>　　# 在使用state&#x3D;absent时, 行为与userdel –force一致.<br><code>group</code>　　# 指定基本组<br><code>groups</code>　　# 指定附加组，如果指定为(groups&#x3D;)表示删除所有组<br><code>home</code>　　# 指定用户家目录<br><code>move_home</code>　　# 如果设置为home&#x3D;时, 试图将用户主目录移动到指定的目录<br><code>name</code>　　# 指定用户名<br><code>non_unique</code>　　# 该选项允许改变非唯一的用户ID值<br><code>password</code>　　# 指定用户密码<br><code>remove</code>　　# 在使用state&#x3D;absent时, 行为是与userdel –remove一致<br><code>shell</code>　　# 指定默认shell<br><code>state</code>　　# 设置帐号状态，不指定为创建，指定值为absent表示删除<br><code>system</code>　　# 当创建一个用户，设置这个用户是系统用户。这个设置不能更改现有用户<br><code>uid</code>　　# 指定用户的uid</p></blockquote><p>　　举例如下：<br><strong>① 添加一个用户并指定其 uid</strong></p><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">[root@server ~]# ansible web -m user -a <span class="hljs-string">&#x27;name=keer uid=11111&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | <span class="hljs-type">SUCCESS</span> =&gt; &#123;<br>    <span class="hljs-comment">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-comment">&quot;comment&quot;</span>: <span class="hljs-comment">&quot;&quot;</span>, <br>    <span class="hljs-comment">&quot;createhome&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-comment">&quot;group&quot;</span>: <span class="hljs-number">11111</span>, <br>    <span class="hljs-comment">&quot;home&quot;</span>: <span class="hljs-comment">&quot;/home/keer&quot;</span>, <br>    <span class="hljs-comment">&quot;name&quot;</span>: <span class="hljs-comment">&quot;keer&quot;</span>, <br>    <span class="hljs-comment">&quot;shell&quot;</span>: <span class="hljs-comment">&quot;/bin/bash&quot;</span>, <br>    <span class="hljs-comment">&quot;state&quot;</span>: <span class="hljs-comment">&quot;present&quot;</span>, <br>    <span class="hljs-comment">&quot;stderr&quot;</span>: <span class="hljs-comment">&quot;useradd: warning: the home directory already exists.\nNot copying any file from skel directory into it.\nCreating mailbox file: File exists\n&quot;</span>, <br>    <span class="hljs-comment">&quot;system&quot;</span>: <span class="hljs-keyword">false</span>, <br>    <span class="hljs-comment">&quot;uid&quot;</span>: <span class="hljs-number">11111</span><br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | <span class="hljs-type">SUCCESS</span> =&gt; &#123;<br>    <span class="hljs-comment">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-comment">&quot;comment&quot;</span>: <span class="hljs-comment">&quot;&quot;</span>, <br>    <span class="hljs-comment">&quot;createhome&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-comment">&quot;group&quot;</span>: <span class="hljs-number">11111</span>, <br>    <span class="hljs-comment">&quot;home&quot;</span>: <span class="hljs-comment">&quot;/home/keer&quot;</span>, <br>    <span class="hljs-comment">&quot;name&quot;</span>: <span class="hljs-comment">&quot;keer&quot;</span>, <br>    <span class="hljs-comment">&quot;shell&quot;</span>: <span class="hljs-comment">&quot;/bin/bash&quot;</span>, <br>    <span class="hljs-comment">&quot;state&quot;</span>: <span class="hljs-comment">&quot;present&quot;</span>, <br>    <span class="hljs-comment">&quot;stderr&quot;</span>: <span class="hljs-comment">&quot;useradd: warning: the home directory already exists.\nNot copying any file from skel directory into it.\nCreating mailbox file: File exists\n&quot;</span>, <br>    <span class="hljs-comment">&quot;system&quot;</span>: <span class="hljs-keyword">false</span>, <br>    <span class="hljs-comment">&quot;uid&quot;</span>: <span class="hljs-number">11111</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　添加完成，我们可以去查看一下：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;cat /etc/passwd |grep keer&#x27;</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> |<span class="hljs-params"> SUCCESS </span>| rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-symbol">keer:</span><span class="hljs-symbol">x:</span><span class="hljs-number">11111</span><span class="hljs-symbol">:</span><span class="hljs-number">11111</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/home/keer</span><span class="hljs-symbol">:/bin/bash</span><br><br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> |<span class="hljs-params"> SUCCESS </span>| rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-symbol">keer:</span><span class="hljs-symbol">x:</span><span class="hljs-number">11111</span><span class="hljs-symbol">:</span><span class="hljs-number">11111</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/home/keer</span><span class="hljs-symbol">:/bin/bash</span><br></code></pre></td></tr></table></figure><p><strong>② 删除用户</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart">[root<span class="hljs-meta">@server</span> ~]# ansible web -m user -a <span class="hljs-string">&#x27;name=keer state=absent&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;force&quot;</span>: <span class="hljs-keyword">false</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;keer&quot;</span>, <br>    <span class="hljs-string">&quot;remove&quot;</span>: <span class="hljs-keyword">false</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;absent&quot;</span><br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;force&quot;</span>: <span class="hljs-keyword">false</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;keer&quot;</span>, <br>    <span class="hljs-string">&quot;remove&quot;</span>: <span class="hljs-keyword">false</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;absent&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　一样的，删除之后，我们去看一下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ansible web -m shell -a &#x27;cat /etc/passwd |grep keer&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | FAILED | rc=<span class="hljs-number">1</span> &gt;&gt;<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | FAILED | rc=<span class="hljs-number">1</span> &gt;&gt;<br></code></pre></td></tr></table></figure><p>　　发现已经没有这个用户了。</p><h3 id="11）group-模块"><a href="#11）group-模块" class="headerlink" title="11）group 模块"></a>11）group 模块</h3><p>　　该模块主要用于添加或删除组。<br>　　常用的选项如下：</p><blockquote><p><code>gid=</code>　　#设置组的GID号<br><code>name=</code>　　#指定组的名称<br><code>state=</code>　　#指定组的状态，默认为创建，设置值为<code>absent</code>为删除<br><code>system=</code>　　#设置值为<code>yes</code>，表示创建为系统组</p></blockquote><p>　　举例如下：<br><strong>① 创建组</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart">[root<span class="hljs-meta">@server</span> ~]# ansible web -m group -a <span class="hljs-string">&#x27;name=sanguo gid=12222&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">12222</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;sanguo&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;present&quot;</span>, <br>    <span class="hljs-string">&quot;system&quot;</span>: <span class="hljs-keyword">false</span><br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-keyword">true</span>, <br>    <span class="hljs-string">&quot;gid&quot;</span>: <span class="hljs-number">12222</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;sanguo&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;present&quot;</span>, <br>    <span class="hljs-string">&quot;system&quot;</span>: <span class="hljs-keyword">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　创建过后，我们来查看一下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile">[root@server ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;cat /etc/group | grep 12222&#x27; </span><br>192.168.37.122 | SUCCESS | rc=0 &gt;&gt;<br><span class="hljs-section">sanguo:x:12222:</span><br><br>192.168.37.133 | SUCCESS | rc=0 &gt;&gt;<br><span class="hljs-section">sanguo:x:12222:</span><br></code></pre></td></tr></table></figure><p>　　可以看出，我们的组已经创建成功了。<br><strong>② 删除组</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># ansible web -m group -a &#x27;name=sanguo state=absent&#x27;</span><br><span class="hljs-meta prompt_">192.168.37.122 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;sanguo&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;absent&quot;</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.37.133 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;sanguo&quot;</span>, <br>    <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;absent&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　照例查看一下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@server ~</span>]<span class="hljs-meta"># ansible web -m shell -a &#x27;cat /etc/group | grep 12222&#x27; </span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> | FAILED | rc=<span class="hljs-number">1</span> &gt;&gt;<br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> | FAILED | rc=<span class="hljs-number">1</span> &gt;&gt;<br></code></pre></td></tr></table></figure><p>　　已经没有这个组的相关信息了。</p><h3 id="12）script-模块"><a href="#12）script-模块" class="headerlink" title="12）script 模块"></a>12）script 模块</h3><p>　　该模块用于将本机的脚本在被管理端的机器上运行。<br>　　该模块直接指定脚本的路径即可，我们通过例子来看一看到底如何使用的：<br>　　首先，我们写一个脚本，并给其加上执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server ~]<span class="hljs-comment"># vim /tmp/df.sh</span><br>	<span class="hljs-comment">#!/bin/bash</span><br><br>	<span class="hljs-built_in">date</span> &gt;&gt; /tmp/disk_total.log<br>	<span class="hljs-built_in">df</span> -lh &gt;&gt; /tmp/disk_total.log <br>[root@server ~]<span class="hljs-comment"># chmod +x /tmp/df.sh </span><br></code></pre></td></tr></table></figure><p>　　然后，我们直接运行命令来实现在被管理端执行该脚本：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs swift">[root<span class="hljs-meta">@server</span> <span class="hljs-operator">~</span>]# ansible web <span class="hljs-operator">-</span>m script <span class="hljs-operator">-</span>a &#x27;<span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>df.sh&#x27;<br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.122</span> <span class="hljs-operator">|</span> <span class="hljs-type">SUCCESS</span> <span class="hljs-operator">=&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;rc&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;stderr&quot;</span>: <span class="hljs-string">&quot;Shared connection to 192.168.37.122 closed.<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>, <br>    <span class="hljs-string">&quot;stdout&quot;</span>: <span class="hljs-string">&quot;&quot;</span>, <br>    <span class="hljs-string">&quot;stdout_lines&quot;</span>: []<br>&#125;<br><span class="hljs-number">192.168</span>.<span class="hljs-number">37.133</span> <span class="hljs-operator">|</span> <span class="hljs-type">SUCCESS</span> <span class="hljs-operator">=&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-string">&quot;rc&quot;</span>: <span class="hljs-number">0</span>, <br>    <span class="hljs-string">&quot;stderr&quot;</span>: <span class="hljs-string">&quot;Shared connection to 192.168.37.133 closed.<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>, <br>    <span class="hljs-string">&quot;stdout&quot;</span>: <span class="hljs-string">&quot;&quot;</span>, <br>    <span class="hljs-string">&quot;stdout_lines&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure><p>　　照例查看一下文件内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server ~]<span class="hljs-comment"># ansible web -m shell -a &#x27;cat /tmp/disk_total.log&#x27;</span><br>192.168.37.122 | SUCCESS | rc=0 &gt;&gt;<br>Tue Dec  5 15:58:21 CST 2017<br>Filesystem      Size  Used Avail Use% Mounted on<br>/dev/sda2        47G  4.4G   43G  10% /<br>devtmpfs        978M     0  978M   0% /dev<br>tmpfs           993M   84K  993M   1% /dev/shm<br>tmpfs           993M  9.1M  984M   1% /run<br>tmpfs           993M     0  993M   0% /sys/fs/cgroup<br>/dev/sda3        47G   33M   47G   1% /app<br>/dev/sda1       950M  153M  798M  17% /boot<br>tmpfs           199M   16K  199M   1% /run/user/42<br>tmpfs           199M     0  199M   0% /run/user/0<br><br>192.168.37.133 | SUCCESS | rc=0 &gt;&gt;<br>Tue Dec  5 15:58:21 CST 2017<br>Filesystem      Size  Used Avail Use% Mounted on<br>/dev/sda2        46G  4.1G   40G  10% /<br>devtmpfs        898M     0  898M   0% /dev<br>tmpfs           912M   84K  912M   1% /dev/shm<br>tmpfs           912M  9.0M  903M   1% /run<br>tmpfs           912M     0  912M   0% /sys/fs/cgroup<br>/dev/sda3       3.7G   15M  3.4G   1% /app<br>/dev/sda1       1.9G  141M  1.6G   9% /boot<br>tmpfs           183M   16K  183M   1% /run/user/42<br>tmpfs           183M     0  183M   0% /run/user/0<br></code></pre></td></tr></table></figure><p>　　可以看出已经执行成功了。</p><h3 id="13）setup-模块"><a href="#13）setup-模块" class="headerlink" title="13）setup 模块"></a>13）setup 模块</h3><p>　　该模块主要用于收集信息，是通过调用facts组件来实现的。<br>　　facts组件是Ansible用于采集被管机器设备信息的一个功能，我们可以使用setup模块查机器的所有facts信息，可以使用filter来查看指定信息。整个facts信息被包装在一个JSON格式的数据结构中，ansible_facts是最上层的值。<br>　　facts就是变量，内建变量 。每个主机的各种信息，cpu颗数、内存大小等。会存在facts中的某个变量中。调用后返回很多对应主机的信息，在后面的操作中可以根据不同的信息来做不同的操作。如redhat系列用yum安装，而debian系列用apt来安装软件。<br><strong>① 查看信息</strong><br>　　我们可以直接用命令获取到变量的值，具体我们来看看例子：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@server</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># ansible web -m setup -a &#x27;filter=&quot;*mem*&quot;&#x27;	#查看内存</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> <span class="hljs-string">|</span> <span class="hljs-string">SUCCESS</span> <span class="hljs-string">=&gt;</span> &#123;<br>    <span class="hljs-attr">&quot;ansible_facts&quot;:</span> &#123;<br>        <span class="hljs-attr">&quot;ansible_memfree_mb&quot;:</span> <span class="hljs-number">1116</span>, <br>        <span class="hljs-attr">&quot;ansible_memory_mb&quot;:</span> &#123;<br>            <span class="hljs-attr">&quot;nocache&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1397</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">587</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;real&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1116</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">1984</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">868</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;swap&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;cached&quot;:</span> <span class="hljs-number">0</span>, <br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">0</span><br>            &#125;<br>        &#125;, <br>        <span class="hljs-attr">&quot;ansible_memtotal_mb&quot;:</span> <span class="hljs-number">1984</span><br>    &#125;, <br>    <span class="hljs-attr">&quot;changed&quot;:</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> <span class="hljs-string">|</span> <span class="hljs-string">SUCCESS</span> <span class="hljs-string">=&gt;</span> &#123;<br>    <span class="hljs-attr">&quot;ansible_facts&quot;:</span> &#123;<br>        <span class="hljs-attr">&quot;ansible_memfree_mb&quot;:</span> <span class="hljs-number">1203</span>, <br>        <span class="hljs-attr">&quot;ansible_memory_mb&quot;:</span> &#123;<br>            <span class="hljs-attr">&quot;nocache&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1470</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">353</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;real&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1203</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">1823</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">620</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;swap&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;cached&quot;:</span> <span class="hljs-number">0</span>, <br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">0</span><br>            &#125;<br>        &#125;, <br>        <span class="hljs-attr">&quot;ansible_memtotal_mb&quot;:</span> <span class="hljs-number">1823</span><br>    &#125;, <br>    <span class="hljs-attr">&quot;changed&quot;:</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　我们可以通过命令查看一下内存的大小以确认一下是否一致：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@server</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># ansible web -m shell -a &#x27;free -m&#x27;</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> <span class="hljs-string">|</span> <span class="hljs-string">SUCCESS</span> <span class="hljs-string">|</span> <span class="hljs-string">rc=0</span> <span class="hljs-string">&gt;&gt;</span><br>              <span class="hljs-string">total</span>        <span class="hljs-string">used</span>        <span class="hljs-string">free</span>      <span class="hljs-string">shared</span>  <span class="hljs-string">buff/cache</span>   <span class="hljs-string">available</span><br><span class="hljs-attr">Mem:</span>           <span class="hljs-number">1984         </span><span class="hljs-number">404</span>        <span class="hljs-number">1122           </span><span class="hljs-number">9</span>         <span class="hljs-number">457</span>        <span class="hljs-number">1346</span><br><span class="hljs-attr">Swap:</span>          <span class="hljs-number">3813           </span><span class="hljs-number">0</span>        <span class="hljs-number">3813</span><br><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> <span class="hljs-string">|</span> <span class="hljs-string">SUCCESS</span> <span class="hljs-string">|</span> <span class="hljs-string">rc=0</span> <span class="hljs-string">&gt;&gt;</span><br>              <span class="hljs-string">total</span>        <span class="hljs-string">used</span>        <span class="hljs-string">free</span>      <span class="hljs-string">shared</span>  <span class="hljs-string">buff/cache</span>   <span class="hljs-string">available</span><br><span class="hljs-attr">Mem:</span>           <span class="hljs-number">1823         </span><span class="hljs-number">292</span>        <span class="hljs-number">1207           </span><span class="hljs-number">9</span>         <span class="hljs-number">323</span>        <span class="hljs-number">1351</span><br><span class="hljs-attr">Swap:</span>          <span class="hljs-number">3813           </span><span class="hljs-number">0</span>        <span class="hljs-number">3813</span><br></code></pre></td></tr></table></figure><p>　　可以看出信息是一致的。<br><strong>② 保存信息</strong><br>　　我们的setup模块还有一个很好用的功能就是可以保存我们所筛选的信息至我们的主机上，同时，文件名为我们被管制的主机的IP，这样方便我们知道是哪台机器出的问题。<br>　　我们可以看一看例子：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@server</span> <span class="hljs-string">tmp</span>]<span class="hljs-comment"># ansible web -m setup -a &#x27;filter=&quot;*mem*&quot;&#x27; --tree /tmp/facts</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span> <span class="hljs-string">|</span> <span class="hljs-string">SUCCESS</span> <span class="hljs-string">=&gt;</span> &#123;<br>    <span class="hljs-attr">&quot;ansible_facts&quot;:</span> &#123;<br>        <span class="hljs-attr">&quot;ansible_memfree_mb&quot;:</span> <span class="hljs-number">1115</span>, <br>        <span class="hljs-attr">&quot;ansible_memory_mb&quot;:</span> &#123;<br>            <span class="hljs-attr">&quot;nocache&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1396</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">588</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;real&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1115</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">1984</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">869</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;swap&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;cached&quot;:</span> <span class="hljs-number">0</span>, <br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">0</span><br>            &#125;<br>        &#125;, <br>        <span class="hljs-attr">&quot;ansible_memtotal_mb&quot;:</span> <span class="hljs-number">1984</span><br>    &#125;, <br>    <span class="hljs-attr">&quot;changed&quot;:</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span> <span class="hljs-string">|</span> <span class="hljs-string">SUCCESS</span> <span class="hljs-string">=&gt;</span> &#123;<br>    <span class="hljs-attr">&quot;ansible_facts&quot;:</span> &#123;<br>        <span class="hljs-attr">&quot;ansible_memfree_mb&quot;:</span> <span class="hljs-number">1199</span>, <br>        <span class="hljs-attr">&quot;ansible_memory_mb&quot;:</span> &#123;<br>            <span class="hljs-attr">&quot;nocache&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1467</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">356</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;real&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1199</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">1823</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">624</span><br>            &#125;, <br>            <span class="hljs-attr">&quot;swap&quot;:</span> &#123;<br>                <span class="hljs-attr">&quot;cached&quot;:</span> <span class="hljs-number">0</span>, <br>                <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">3813</span>, <br>                <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">0</span><br>            &#125;<br>        &#125;, <br>        <span class="hljs-attr">&quot;ansible_memtotal_mb&quot;:</span> <span class="hljs-number">1823</span><br>    &#125;, <br>    <span class="hljs-attr">&quot;changed&quot;:</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>　　然后我们可以去查看一下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@server</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cd /tmp/facts/</span><br>[<span class="hljs-string">root@server</span> <span class="hljs-string">facts</span>]<span class="hljs-comment"># ls</span><br><span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.122</span>  <span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.133</span><br>[<span class="hljs-string">root@server</span> <span class="hljs-string">facts</span>]<span class="hljs-comment"># cat 192.168.37.122 </span><br>&#123;<span class="hljs-attr">&quot;ansible_facts&quot;:</span> &#123;<span class="hljs-attr">&quot;ansible_memfree_mb&quot;:</span> <span class="hljs-number">1115</span>, <span class="hljs-attr">&quot;ansible_memory_mb&quot;:</span> &#123;<span class="hljs-attr">&quot;nocache&quot;:</span> &#123;<span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1396</span>, <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">588</span>&#125;, <span class="hljs-attr">&quot;real&quot;:</span> &#123;<span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">1115</span>, <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">1984</span>, <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">869</span>&#125;, <span class="hljs-attr">&quot;swap&quot;:</span> &#123;<span class="hljs-attr">&quot;cached&quot;:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">&quot;free&quot;:</span> <span class="hljs-number">3813</span>, <span class="hljs-attr">&quot;total&quot;:</span> <span class="hljs-number">3813</span>, <span class="hljs-attr">&quot;used&quot;:</span> <span class="hljs-number">0</span>&#125;&#125;, <span class="hljs-attr">&quot;ansible_memtotal_mb&quot;:</span> <span class="hljs-number">1984</span>&#125;, <span class="hljs-attr">&quot;changed&quot;:</span> <span class="hljs-literal">false</span>&#125;<br></code></pre></td></tr></table></figure><hr><p><a target="_blank" rel="noopener" href="https://www.msft.vip/2023/01/31/Ansible-Detailed-Tutorial-II/">Ansible-Detailed-Tutorial-II</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/linux/" class="category-chain-item">linux</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/ansible/">#ansible</a></div></div><div class="license-box my-3"><div class="license-title"><div>Ansible Detailed Tutorial I</div><div>https://git.msft.vip/2023/01/31-Ansible-Detailed-Tutorial-I/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Jas0n0ss</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年1月31日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年8月9日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><span class="hint--top hint--rounded" aria-label="ND - 禁止演绎"><i class="iconfont icon-nd"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/01/31-Ansible-Detailed-Tutorial-II/" title="Ansible Detailed Tutorial II"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Ansible Detailed Tutorial II</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/01/31-Fancy-indexes-module-for-the-Nginx-web-server/" title="Fancy indexes module for the Nginx web server"><span class="hidden-mobile">Fancy indexes module for the Nginx web server</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>Fluid.utils.loadComments("#disqus_thread",(function(){Fluid.utils.createCssLink("https://cdn.staticfile.org/disqusjs/1.3.0/disqusjs.css"),Fluid.utils.createScript("https://cdn.staticfile.org/disqusjs/1.3.0/disqus.js",(function(){new DisqusJS({shortname:"fluid",apikey:""})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js",(function(){mermaid.initialize({theme:"default"}),Fluid.events.registerRefreshCallback((function(){"mermaid"in window&&mermaid.init()}))}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Copyrights</span></a> <i class="iconfont icon-love"></i> <a href="https://git.msft.vip" target="_blank" rel="nofollow noopener"><span>Jas0n0ss</span></a></div></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://cdn.staticfile.org/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://cdn.staticfile.org/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://cdn.staticfile.org/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>